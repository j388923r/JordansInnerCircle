<html>
    <head>
        <title>Simple As Love</title>
        <!-- Deeclaring global budget variables -->
       
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
         <script type='text/javascript' > 
          total_budget = 8000; //Dummy data to set total budget to initial value
          remaining = 8000;   
        </script>
        
        <!-- Fonts -->
        <link href="http://fonts.googleapis.com/css?family=Oleo+Script" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Great+Vibes" rel="stylesheet" type="text/css">
        
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

        <link rel="stylesheet" href="mainLayout.css">

        <script type="text/javascript" src="jquery/js/jquery-ui-1.10.0.custom.min.js"></script>

      
        
        <!--<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
        <script src="//code.jquery.com/jquery-1.10.2.js"></script>
        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>-->
        
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

        <!-- For drag and drop uploader -->
        <script type="text/javascript" src="dropzone.js"></script>
        <link rel="stylesheet" type="text/css" href="dropzone.css" />

        <script type="text/javascript" src="Idea.js"></script>
        
        <!-- For Cool Tagging -->
        <script type="text/javascript" src="bootstrap-tagsinput/bootstrap-tagsinput.js"></script>
        <link rel="stylesheet" type="text/css" href="bootstrap-tagsinput/bootstrap-tagsinput.css"/>

        <script type="text/javascript" src="js/jquery.tablesorter.min.js"></script>

        <script>

            var costMapping = {'lessThan500':[], '500To2000':[], '2000To5000':[], 'moreThan5000': []};
            var categoryMapping = {'Cake':[],'Clothing':[],'Decorations':[], 'Entertainment':[],'Flowers':[], 'Venue':[], 'Wedding Gifts':[], 'Catering':[], 'Invitations':[], 'Other':[]};
            var tagsMapping = {'vegas':[], 'prince':[]};
            var titleMapping = {};
            var categoriesAndCosts = {"Cake":[],"Catering":[],"Clothing":[],"Decorations":[],"Entertainment":[],"Flowers":[],"Venue":[],"Invitations":[],"Wedding Gifts":[], "Other":[]};
            for (key in categoriesAndCosts) {
                categoriesAndCosts[key] = 0;
            }

            var categorieslist = ["Cake","Catering","Clothing","Decorations","Entertainment","Flowers","Venue","Invitations","Wedding Gifts", "Other"];
            var tagsList = [];
            var costList = ["less than 500", "500 to 2000", "2001 to 5000", "more than 5000"];
            var costListForCheckAll = ['lessThan500', '500To2000', '2000To5000', 'moreThan5000'];
            var titleList = [];

            var categoryColors = {'Cake':['E6E6E6','D9D9D9'],'Catering':['D9C7B0','CCBBA5'],'Clothing':['A1D8E6','98CCD9'],'Decorations':['CDBDD9','C1B1CC'], 'Entertainment':['9EBCE6','96B2D9'], 'Flowers':['BFE6A1','B5D998'], 'Invitations':['D9A7A7','CC9D9D'], 'Venue':['FFC59C','F2BB94'], 'Wedding Gifts':['A8E6CD','9ED9C1'], 'Other':['E6D97C','D9CD75']};

            var costFilters = [];
            var categoryFilters = [];
            var tagFilters = [];

            var allNonDeletedIdeas = [];
            var deletedIdeas = [];
            var ideasInIdeas = [];
            var ideasInDecisions = [];

            var isAllChecked = false;
            var checked_arr = [];
            
            var page = 'home';
            var decisionLeft, ideaLeft;
            var ideaViewState = 'bulletin', decisionViewState = 'bulletin';
            var down = undefined;
            var draggedSticky = undefined;

            var ideasToShow = [];

            var searchedFor = [];
            
            var checkedIdeas = [];
            var checkedDecisions = [];

            var deletedInt = 0

            var shorten = function(input, length) {
                return input;
                /*if(input.length < length)
                    return input;
                 else
                    return input.substring(0, length - 3) + "...";*/
            }

            var ideaBeingEditted = undefined; // The idea that is currently being editted
            
            $(document).ready(function(){

                localStorage.clear();

                var ideaBoard = document.getElementById('ideaBoard');
                
                var decisionBoardLeft = Number($('#decisionBoard').css('margin-left').substring(0, $('#decisionBoard').css('margin-left').length - 2));
                var boardBackgroundLeft = Number($('#ideaBoard').css('margin-left').substring(0, $('#ideaBoard').css('margin-left').length - 2));
                ideaLeft = boardBackgroundLeft;
                //console.log(boardBackgroundLeft);
                var decisionLeft = decisionBoardLeft - boardBackgroundLeft;
                var decisionBoard = document.getElementById('decisionBoard');
                var first =  document.getElementById('lessThan500');
                var second = document.getElementById('500To2000');
                var third = document.getElementById('2000To5000');
                var fourth = document.getElementById('moreThan5000');
                
                document.getElementById("budgetRemaining").innerHTML = remaining;

                $('#moveRight').hide();
                $('#moveLeft').hide();

                var temp = listUnion(categorieslist,tagsList);
                var searchSource = listUnion(temp,titleList);

                first.addEventListener("change", checkboxChange);
                second.addEventListener("change", checkboxChange);
                third.addEventListener("change", checkboxChange);
                fourth.addEventListener("change", checkboxChange);


                buildFilter(categorieslist, tagsList); //change to names
                $('[data-toggle="popover"]').popover({
                    placement : 'bottom',
                    content : '<input type="text" placeholder="Filter term"/>'
                });
                
                $('#filters').click(function() {
                    var categories = document.getElementById("filterPopover");
                    categories.hidden = !categories.hidden;
                    buildFilter(categorieslist, tagsList); //change to names
                    //working here
                    if($('#filterIcon').hasClass("glyphicon glyphicon-menu-down")){
                        $('#filterIcon').removeClass("glyphicon glyphicon-menu-down")
                        $('#filterIcon').addClass("glyphicon glyphicon-menu-up")
                    }
                    else{
                        $('#filterIcon').removeClass("glyphicon glyphicon-menu-up")
                        $('#filterIcon').addClass("glyphicon glyphicon-menu-down")
                    }
                });

                $('#btnCheckAll').click(function() {
                    isAllChecked = true;
                    checkAll();
                });

                $('#btnUncheckAll').click(function() {
                    uncheckAll();
                    isAllChecked = false;
                });

                $('#search').keyup(function(e) {
                    clearing();
                    if(e.keyCode == 13){
                        $('#search').autocomplete("close");
                    }
                    var input = $("#search");
                    var inputValue = $(input).val();
                    console.log(inputValue);
                    searching(inputValue);
                    if(inputValue == ""){
                        clearing();
                    }

                });


                $('#search').autocomplete({
                    source: searchSource,
                    open: function( event, ui ) {
                        setTimeout(function(){
                            $('.ui-autocomplete').css('z-index', 9999);
                        }, 50);
                    }
                });
                $("#search").autocomplete( "option", "autoFocus", false );
                $("#search").autocomplete( "option", "minLength", 1 );
                $("#search").autocomplete( "option", "delay", 0);
                $("#search").css("z-index","10000")

                
                $('.stickynote').mousedown(stickyDown);
                
                $('.stickynote').mouseup(stickyUp);
                
                $('.stickynote').mousemove(stickyMove);
                
                $('.stickynote').draggable(draggableObject);
                
                $('#ideaBoard, #decisionBoard').mouseleave(function(event) {
                    //down = undefined;
                });

                $('#addStickyButton').click(function(){
                    var popupAddSticky = document.getElementById("addStickyPopup");
                    popupAddSticky.style.display = 'block';

                    $($('#addStickyPopup').children()[0]).focus();
                });

                $('#cancelStickyButton').click(function(){
                    restoreBorderColor();
                    closeAndClearForm();
                })

                $('#saveStickyButton').click(function(){
                    
                    // if a new idea is being created
                    if (ideaBeingEditted == undefined){ 
                        createNewIdea();

                    // if an existing idea is being editted
                    } else { 
                        updateIdea(ideaBeingEditted);
                    }

                });
                
                $('#trashIcon').mouseover(function(event) {
                    var trashcan = $(event.target);
                    console.log(trashcan);

                    if (draggedSticky){
                        $("#trashPic").attr("src", "full_trash.png");
                    }
                })
                
                $('#trashIcon').mouseleave(function(event) {
                    var trashcan = $(event.target);

                    if (draggedSticky && deletedIdeas.length == 0){
                        $("#trashPic").attr("src", "empty_trash.png");
                    }
                })

                $('#trashIcon').mouseup(function(event) {
                    
                    if(draggedSticky && down) {
                        down = undefined;
                        var children = $(draggedSticky).children();
                        var idea = new Idea($(children[1]).text(), $(children[0]).text(), Number($(children[2]).text().substring(1)));
                        $(draggedSticky).remove();
                        for(var i = 0; i < allNonDeletedIdeas.length; i++) {
                            var ideaToDelete = allNonDeletedIdeas[i];
                            if(ideaToDelete.getTitle() === $(children[1]).text() && ideaToDelete.getCategory() === $(children[0]).text()) {
                                allNonDeletedIdeas.splice(i, 1);
                                break;
                            }
                        }
                        for(var i = 0; i < ideasInIdeas.length; i++) {
                            var ideaToDelete = ideasInIdeas[i];
                            if(ideaToDelete.getTitle() === $(children[1]).text() && ideaToDelete.getCategory() === $(children[0]).text()) {
                                ideasInIdeas.splice(i, 1);
                                break;
                            }
                        }

                        deletedIdeas.push(idea);
                        removeFromDicts(idea);

                        var temp = listUnion(categorieslist,tagsList);
                        var searchSource = listUnion(temp,titleList);
                        $('#search').autocomplete({
                            source: searchSource,
                            open: function( event, ui ) {
                                setTimeout(function(){
                                    $('.ui-autocomplete').css('z-index', 9999);
                                }, 50);
                            }
                        });

                        $("#trashPic").attr("src", "full_trash.png")
                    }
                });
                
                $('#trashIcon').click(function(){

                    var rows = $($('#ideaListView').children()[0]).children();
                    for(var i = 0; i < rows.length; i++) {
                        if($($(rows[i]).children()[0]).children()[0].checked) {
                            var idea = getNonDeletedIdeaTable($(rows[i]).children()[0]);
                            ideasInIdeas.splice(i, 1);
                            deletedIdeas.push(idea);

                            console.log(costMapping);

                            removeFromDicts(idea);
                            console.log(costMapping);
                            $(rows[i]).remove();
                        }
                    }
                    var rows = $($('#decisionListView').children()[0]).children();
                    for(var i = 0; i < rows.length; i++) {
                        if($($(rows[i]).children()[0]).children()[0].checked) {
                            var idea = getNonDeletedIdeaTable($(rows[i]).children()[0]);
                            ideasInDecisions.splice(i, 1);
                            deletedIdeas.push(idea);
                            $(rows[i]).remove();

                            console.log(costMapping);
                            removeFromDicts(idea);
                            console.log(costMapping);
                        }
                    }



                    var temp = listUnion(categorieslist,tagsList);
                    var searchSource = listUnion(temp,titleList);
                    $('#search').autocomplete({
                        source: searchSource,
                        open: function( event, ui ) {
                            setTimeout(function(){
                                $('.ui-autocomplete').css('z-index', 9999);
                            }, 50);
                        }
                    });
                });

                
                $("#budget_button").click(function() { 
                    var iframe = $('#budget_iframe');
                    $('#budget_iframe').attr('src', $('#budget_iframe').attr('src'));
                    iframe.css("display", "block");
                    //$("#iframeClose").css("display", "block");
                    //iframe.css({"height":"400", "width":"800", "border":"none"});
                });
                
                $("#moveRight").click(function() {
                    var rows = $($('#ideaListView').children()[0]).children();
                    for(var i = 0; i < rows.length; i++) {
                        if($($(rows[i]).children()[0]).children()[0].checked) {
                            var idea = getNonDeletedIdeaTable($(rows[i]).children()[0]);
                            $('#decisionBoard').append(idea.ideaDiv);
                            remaining -= Number(idea.cost);
                            $('#budgetRemaining').text(remaining);
                            console.log("Decision shoot");
                            idea.ideaDiv.show();
                            idea.ideaRow.remove();
                            idea.ideaRow.children().children()[0].checked = false;
                            var ideaIndex = ideasInIdeas.indexOf(idea);
                            ideasInIdeas.splice(ideaIndex, 1);
                            if(decisionViewState === 'list') {
                                $('#decisionListView').append(idea.ideaRow);
                                idea.ideaDiv.hide();
                            }
                            ideasInDecisions.push(idea);
                            if(ideasInIdeas.length === 0) {
                                $('#moveRight').hide();
                            }
                        }
                    }

                    updateBudgetList();

                });

                $("#moveLeft").click(function() {
                    var rows = $($('#decisionListView').children()[0]).children();
                    for(var i = 0; i < rows.length; i++) {
                        if($($(rows[i]).children()[0]).children()[0].checked) {
                            var idea = getNonDeletedIdeaTable($(rows[i]).children()[0]);
                            $('#ideaBoard').append($(idea.ideaDiv));
                            remaining += Number(idea.cost);
                            $('#budgetRemaining').text(remaining);
                            console.log("Idea shoot");
                            idea.ideaDiv.show();
                            idea.ideaRow.remove();
                            idea.ideaRow.children().children()[0].checked = false;
                            ideasInIdeas.push(idea);
                            var ideaIndex = ideasInDecisions.indexOf(idea);
                            if(ideaViewState === 'list') {
                                $('#ideaListView').append(idea.ideaRow);
                                idea.ideaDiv.hide();
                            }
                            ideasInDecisions.splice(ideaIndex, 1);
                            if(ideasInDecisions.length === 0) {
                                $('#moveLeft').hide();
                            }
                        }
                    }

                    updateBudgetList();
                });
            });

            var updateBudgetList = function() {
                 for (key in categoriesAndCosts) {
                        categoriesAndCosts[key] = 0;
                }
                //Add for budget data propagation
                for(var i=0; i < ideasInDecisions.length; i++) {
                        var current_idea = ideasInDecisions[i];
                        var category = current_idea.getCategory();
                        var cost = current_idea.getCost(); 
                        categoriesAndCosts[category] = parseFloat(categoriesAndCosts[category]) + parseFloat(cost);
                }

                (function (global) {
                    global.localStorage.setItem("shared_categories_costs", JSON.stringify(categoriesAndCosts));
                    console.log("global prototype:", global.localStorage.getItem("shared_categories_costs"));
                }(window));
                        

            }

            //function that takes in categories and tags list and contructs the filter 
            //do we want to do cost filtering dynamically or have set intervals

            var buildFilter = function(cat_arr, tag_arr) {
                var temp = listUnion(categorieslist,tagsList);
                var searchSource = listUnion(temp,titleList);
                $('#search').autocomplete({
                    source: searchSource,
                    open: function( event, ui ) {
                        setTimeout(function(){
                            $('.ui-autocomplete').css('z-index', 9999);
                        }, 50);
                    }
                });
                cat_arr.sort();
                tag_arr.sort();
                $("#categories").html("");
                $("#tags").html("");
                for (var i = 0; i < cat_arr.length; i++) {
                    var cat = cat_arr[i];
                    var newCat = document.createElement("input");
                    newCat.type = "checkbox";
                    newCat.name = "cat";
                    newCat.id = cat;
                    newCat.onchange = checkboxChange;
                    
                    newCat.checked = isAllChecked;

                    for(var j = 0; j < checked_arr.length; j++){
                        if(checked_arr[j] == cat){
                            newCat.checked = true;
                        }
                    }

                    var newList = document.createElement("li");

                    $(newList).append(newCat);
                    $(newList).append("  " + cat);
                    // var newString = "<li><input type=\"checkbox\" name="+ cat+" />  " + cat+ "</li>"; //might need to change to allow addition of event listeners
                    $("#categories").append(newList);
                };
                for (var i = 0; i < tag_arr.length; i++) {
                    var tag = tag_arr[i];
                    var newTag = document.createElement("input");
                    newTag.type = "checkbox";
                    newTag.name = "tag";
                    newTag.id = tag;
                    
                    newTag.checked = isAllChecked;
                    newTag.onchange = checkboxChange;

                    for(var j = 0; j < checked_arr.length; j++){
                        if(checked_arr[j] == tag){
                            newTag.checked = true;
                        }
                    }

                    var newList = document.createElement("li");

                    $(newList).append(newTag);
                    $(newList).append("  " + tag);
                    // var newString = "<li><input type=\"checkbox\" name="+ tag+" />  " + tag+ "</li>";
                    $("#tags").append(newList);
                };
            }

            var checkAll = function() {
                var boxes = document.getElementsByTagName('input');
                for(var i = 0; i< boxes.length; i++){
                    if(boxes[i].type == 'checkbox') {
                        boxes[i].checked = true;
                    }
                }
                for(var i = 0; i < categorieslist.length; i++) {
                    categoryFilters.push(categorieslist[i]);
                }
                for(var i = 0; i < tagsList.length; i++) {
                    tagFilters.push(tagsList[i]);
                }
                for(var i = 0; i < costListForCheckAll.length; i++) {
                    costFilters.push(costListForCheckAll[i]);
                }
                updateFilter();
            }

            var uncheckAll = function() {
                var boxes = document.getElementsByTagName('input');
                for(var i = 0; i< boxes.length; i++){
                    if(boxes[i].type == 'checkbox') {
                        boxes[i].checked = false;
                        checked_arr = []

                    }
                }
                categoryFilters = [];
                tagFilters = [];
                costFilters = [];
                updateFilter();

            }

            var checkboxChange = function() {
                if(this.checked){
                    checked_arr.push(this.id);
                    //console.log(this.name);
                    if(this.name == "cat"){
                        categoryFilters.push(this.id);
                    }
                    else if(this.name == "cost"){
                        costFilters.push(this.id);
                    }
                    else {
                        tagFilters.push(this.id);
                    }
                }
                else{
                    //console.log("remove filter")
                    for(var i = 0; i < checked_arr.length; i++){
                        if(checked_arr[i]== this.id){
                            checked_arr.splice(i,1);
                        }
                    }
                    if(this.name == "cat"){
                        for(var i = 0; i < categoryFilters.length; i++){
                            if(categoryFilters[i]== this.id){
                                categoryFilters.splice(i,1);
                            }
                        }
                    }
                    else if(this.name == "cost"){
                        for(var i = 0; i < costFilters.length; i++){
                            if(costFilters[i]== this.id){
                                costFilters.splice(i,1);
                            }
                        }
                    }
                    else {

                        for(var i = 0; i < tagFilters.length; i++){
                            if(tagFilters[i]== this.id){
                                tagFilters.splice(i,1);
                            }
                        }
                    }

                }
                updateFilter();
            }

            var updateFilter = function() {
                var costset = [];
                var catset = [];
                var tagset = [];
                ideasToShow = [];
                for(var i = 0; i< costFilters.length; i++){
                    costset = listUnion(costset,costMapping[costFilters[i]]);
                }

                for(var i = 0; i< tagFilters.length; i++){
                    tagset = listUnion(tagset, tagsMapping[tagFilters[i]]);
                }
                for(var i = 0; i< categoryFilters.length; i++){
                    catset = listUnion(catset, categoryMapping[categoryFilters[i]]);
                }
                
                if(costFilters.length == 0){
                    costset = allNonDeletedIdeas;
                }
                if(tagFilters.length == 0){
                    tagset = allNonDeletedIdeas;
                }
                if(categoryFilters.length == 0 ) {
                    catset = allNonDeletedIdeas;
                }

                var temp_arr = listInter(catset, costset);
                ideasToShow = listInter(temp_arr, tagset);

                // console.log("ideasToShow");
                // console.log(ideasToShow);

                // console.log("allNonDeletedIdeas");
                // console.log(allNonDeletedIdeas);

                // console.log("cost dict");
                // console.log(costMapping);

                for(var i = 0; i < allNonDeletedIdeas.length; i++){
                    //not sure how to hide an idea but trying to do that here
                    allNonDeletedIdeas[i].hide();
                }
                
                if(ideaViewState === 'bulletin') {
                    for(var i = 0; i< ideasToShow.length; i++){
                        ideasToShow[i].setVisible();
                    }
                } else {
                    for(var i = 0; i< ideasToShow.length; i++){
                        $('#ideaListView').append(ideasToShow[i].ideaRow);
                    }
                }
            }


            var searching = function(term) {
                var term = term;
                var searchList = []
                // for(var i= 0; i< costList.length; i++){
                //     if(term == costList[i]){
                //         searchedFor.push(costListForCheckAll[i]);
                //         searchList = listUnion(searchList, costMapping[costListForCheckAll[i]])
                //         // ideasToShow = listInter(ideasToShow, costMapping[costListForCheckAll[i]]);
                //     }
                // }
                for(var i = 0; i< tagsList.length; i++ ){
                    if(stringContains(tagsList[i],term)){
                        searchedFor.push(tagsList[i]);
                        searchList = listUnion(searchList, tagsMapping[tagsList[i]])
                        // ideasToShow = listInter(ideasToShow, tagsMapping[tagsList[i]]);
                    }
                }
                for(var i = 0; i< categorieslist.length; i++){
                    if(stringContains(categorieslist[i],term)){
                        searchedFor.push(categorieslist[i]);
                        searchList = listUnion(searchList, categoryMapping[categorieslist[i]])
                        // ideasToShow = listInter(ideasToShow, categoryMapping[categorieslist[i]]);
                    }
                }
                for(var i = 0; i < titleList.length; i++){

                    if(stringContains(titleList[i],term)){
                        searchedFor.push(titleList[i]);
                        searchList = listUnion(searchList, titleMapping[titleList[i]])
                    }
                }

                ideasToShow = listInter(ideasToShow,searchList)

                for(var i = 0; i < allNonDeletedIdeas.length; i++){
                    //not sure how to hide an idea but trying to do that here
                    allNonDeletedIdeas[i].hide();
                }
                for(var i = 0; i< ideasToShow.length; i++){
                    //console.log(ideasToShow);
                    ideasToShow[i].setVisible();
                }

            }

            var clearing = function(){
                updateFilter();
                searchedFor = [];
            }

            var listUnion = function(list1, list2) {
                var retList = [];
                var list1 = list1;
                for(var i = 0; i< list1.length; i++){
                    retList.push(list1[i]);
                }
                var list2 = list2;
                for(var i = 0; i < list2.length; i++){
                    var inRetList = false;
                    for(var j = 0; j < retList.length; j++){
                        if(list2[i] == retList[j]){
                            inRetList = true;
                        }
                    }
                    if(!inRetList){
                        retList.push(list2[i]);
                    }
                }
                return retList;
            }

            var listInter = function(list1, list2) {
                var retList = [];
                var list1 = list1;
                var list2 = list2;
                for(var i = 0; i < list1.length; i++){
                    var matched = false;
                    for(var j = 0; j < list2.length; j++){
                        if(list1[i] == list2[j]){
                            matched = true;
                        }
                    }
                    if(matched){
                        retList.push(list1[i]);
                    }
                }
                return retList;
            }

            var stringContains = function(title, term) {
                title = title.toLowerCase();
                term = term.toLowerCase();
                return title.indexOf(term) > -1;
            }
            
            var show = function(boardName) {
                page = boardName;
                if(boardName === 'ideas') {
                    $('#ideaBoard').show();
                    $('#ideaBoard').css('width', '96%');
                    $('#ideaBoard').css('margin-left', '2%');
                    $('#ideaHeader').css('margin-left', '38%');
                    $('#decisionBoard').hide();
                } else if(boardName === 'decisions') {
                    $('#decisionBoard').show();
                    $('#decisionBoard').css('width', '96%');
                    $('#decisionBoard').css('margin-left', '2%');
                    $('#decisionHeader').css('margin-left', '38%');
                    $('#ideaBoard').hide();
                } else {
                    $('#decisionBoard, #ideaBoard').show();
                    $('#ideaBoard').css('margin-left', '1%');
                    $('#decisionBoard, #ideaBoard').css('width', '48.5%');
                    $('#decisionBoard').css('margin-left', '50.5%');
                    $('#decisionHeader, #ideaHeader').css('margin-left', '15.5%');
                }
            };

            var switchView = function(boardName) {
                if(boardName === 'ideas') {
                    if(ideaViewState === 'list') {
                        for(var i = 0; i < ideasInIdeas.length; i++) {
                            var idea = ideasInIdeas[i];
                            idea.ideaDiv.show();
                            idea.ideaRow.remove();
                        }
                        $('#moveRight').hide();
                        ideaViewState = 'bulletin';
                    } else if(ideasInIdeas.length > 0){
                        for(var i = 0; i < ideasInIdeas.length; i++) {
                            var idea = ideasInIdeas[i];
                            idea.ideaDiv.hide();
                            $('#ideaListView').append(idea.ideaRow);
                        }
                        $('#moveRight').show();
                        ideaViewState = 'list';
                    }
                } else if(boardName === 'decisions') {
                    if(decisionViewState === 'list') {
                        decisionViewState = 'bulletin';
                        for(var i = 0; i < ideasInDecisions.length; i++) {
                            var idea = ideasInDecisions[i];
                            idea.ideaDiv.show();
                            idea.ideaRow.remove();
                        }
                        $('#moveLeft').hide();
                    } else if(ideasInDecisions.length > 0){
                        decisionViewState = 'list';
                        for(var i = 0; i < ideasInDecisions.length; i++) {
                            var idea = ideasInDecisions[i];
                            idea.ideaDiv.hide();
                            $('#decisionListView').append(idea.ideaRow);
                        }
                        $('#moveLeft').show();
                    }
                }
            }

            var load = function(page_name) {

                if(page_name === 'budget_page') {                  
                    var iframe = $('#budget_iframe');
                    iframe.css("display", "block");
                    //$("#iframeClose").css("display", "block");
                    //iframe.css({"height":"400", "width":"800", "border":"none"});
                }

            }

            function closeWindows() {
                
                var iframe = $('#budget_iframe');
                iframe.css("display", "none");
               // $("#iframeClose").css("display", "none");

                // function to set remaining budget the same
                (function (global) {
                    document.getElementById("budgetRemaining").innerHTML = global.localStorage.getItem("shared_remaining_budget");
                }(window));

                var deleted_frame = $('.deleted_archive_view');
                deleted_frame.css("display", "none"); 
                //$("#iframeClose").css("display", "none");

            }

            var createNewIdea = function(){
                restoreBorderColor();

                ideaTitle = $('#ideaTitleInput').val();
                ideaCost = $('#ideaCostInput').val();
                ideaCategory = $("#categoryDropDown").val();
                ideaPics = $("#picUploader").context.URL;
                ideaDescription = $("#ideaDescriptionInput").val();
                ideaTags = $("#ideaTagInput").tagsinput("items");

                var validIdea = checkUserInputs(ideaTitle, ideaCost, ideaCategory);
                if (!validIdea){
                    missingInputFeedback();
                    return;
                }
                
                var idea = new Idea(ideaTitle, ideaCategory, ideaCost);

                // Add attributes to ideas.. except for pic...
                categoryMapping[ideaCategory].push(idea);
                updateCostMapping(idea, ideaCost);
                updateTitleMapping(idea, ideaTitle);
                if (ideaDescription != ""){
                    idea.updateDescription(ideaDescription);
                }
                if (ideaTags.length != 0){
                    idea.updateTags(ideaTags);
                    updateTagMapping(idea, ideaTags);
                }

                allNonDeletedIdeas.push(idea);
                ideasInIdeas.push(idea);

                var temp = listUnion(categorieslist,tagsList);
                var searchSource = listUnion(temp,titleList);
                $('#search').autocomplete({
                    source: searchSource,
                    open: function( event, ui ) {
                        setTimeout(function(){
                            $('.ui-autocomplete').css('z-index', 9999);
                        }, 50);
                    }
                });
                
                var decisionBoardLeft = Number($('#decisionBoard').css('margin-left').substring(0, $('#decisionBoard').css('margin-left').length - 2));
                var boardBackgroundLeft = Number($('#ideaBoard').css('margin-left').substring(0, $('#ideaBoard').css('margin-left').length - 2));
                ideaLeft = boardBackgroundLeft;
                //console.log(boardBackgroundLeft);
                decisionLeft = decisionBoardLeft - boardBackgroundLeft;
                
                console.log(true);
                
                var ideaHtml = "<div class='stickynote' unselectable='on' style='background: #" + categoryColors[idea.category][0] + "'>" +
                               "<div style='background: #" +categoryColors[idea.category][1]+ ";pointer-events:none'>" +
                               "<h2 style='font-size: 125%; pointer-events:none'>" + idea.category + "</h2>" +
                               "</div>" +
                               "<h2 style='font-size: 100%;text-align:left;margin:10%;pointer-events:none'>" + idea.title + "</h6>" +
                               "<h2 style='bottom: 0;font-size: 100%;text-align:left;margin:10%;pointer-events:none'>$" + idea.cost + "</h6>" + 
                               "</div>";
                               
                var ideaDiv = $(ideaHtml);

                idea.setDiv(ideaDiv);

                ideaDiv.mousedown(stickyDown);
                
                ideaDiv.mouseup(stickyUp);
                
                ideaDiv.mousemove(stickyMove);
                
                ideaDiv.draggable(draggableObject);

                $('#ideaBoard').append(ideaDiv);
                
                var ideaRowHTML = "<tr>" +
                               "<td style='font-size: 24'> <input type='checkbox'></input> </td>" + 
                               "<td style='font-weight:bold;font-size: 24'>" + shorten(idea.category, 12) + "</td>" +
                               "<td style='font-size: 24'>" + idea.title + "</td>" +
                               "<td style='font-size: 24'>$" + idea.cost + "</td>" + 
                               //"<span style='font-size: 24'> <span style='color:red' class='glyphicon glyphicon-remove'></span> </span>" + 
                               //"<span style='font-size: 24'> <span style='color:#66CDAA' class='glyphicon glyphicon-circle-arrow-right'></span> </span>" + 
                               "</tr>";
                var ideaRow = $(ideaRowHTML);
                
                ideaRow.click(function(e){
                    console.log($(e.target), $(e.target).parent().children().length);
                    if($(e.target).parent().children().length > 2) {
                        var idea = getNonDeletedIdeaTable(e.target);
                        var div = document.getElementById("ideaView");
                        div.style.display = "block";
                        $("#ideaView").html(idea.getHtml());

                        // Edit Click Listener
                        $('.editIdeaView').click(function(event){
                            console.log("Edit!");
                            var div = document.getElementById("ideaView");
                            div.style.display = "none";
                            $("ideaView").html('');

                            ideaBeingEditted = idea;
                            var popupAddSticky = document.getElementById("addStickyPopup");
                            popupAddSticky.style.display = "block";
                            $('#addStickyPopup').children()[0].focus();
                            
                            $("#ideaTitleInput").val(idea.getTitle());
                            //show image
                            $("#ideaDescriptionInput").val(idea.getDescription());
                            $("#ideaCostInput").val(idea.getCost());
                            document.getElementById("categoryDropDown").value = idea.getCategory();
                            var tagList = idea.getTags();
                            console.log(tagList);
                            var tagString = "";
                            for(var i = 0; i < tagList.length; i++)
                                tagString += tagList[i] + "\n";
                            $("#ideaTagInput").val(tagString);
                            $($('#addStickyPopup').children()[0]).focus();

                            $("#stickyNoteHeader").attr('background-color',categoryColors[idea.getCategory()][1]);
                        });

                        // Cancel click listener
                        $('.cancelIdeaView').click(function(event){
                            console.log("CLICK!");
                            var div = document.getElementById("ideaView");
                            div.style.display = "none";
                            $("ideaView").html('');
                        });
                    }
                });
                
                idea.ideaRow = ideaRow;
                               
                if(ideaViewState === 'list') {
                    $('#ideaListView').append(ideaRow);
                    ideaDiv.hide();
                }
                    
                // closing and clearing form!! :DD
                closeAndClearForm();

                updateFilter();
            }

            var updateIdea = function(idea){
                restoreBorderColor();
                removeFromDicts(idea);

                var ideaTitle = $('#ideaTitleInput').val();
                var ideaCost = $('#ideaCostInput').val();
                var ideaCategory = $("#categoryDropDown").val();
                var ideaPics = $("#picUploader").context.URL;
                var ideaDescription = $("#ideaDescriptionInput").val();
                var ideaTags = $("#ideaTagInput").tagsinput("items");

                var validIdea = checkUserInputs(ideaTitle, ideaCost, ideaCategory);
                console.log(validIdea);
                if (!validIdea){
                    missingInputFeedback();
                    return;
                }

                idea.updateTitle(ideaTitle);
                idea.updateCost(ideaCost);
                idea.updateCategory(ideaCategory);
                               
                var children = $(idea.ideaDiv).children();
                //console.log(children);
                $(children[1]).html("<h2 style='font-size: 100%;text-align:left;margin:10%;pointer-events:none'>" + idea.title + "</h6>");
                $(children[0]).html("<h2 style='font-size: 125%;pointer-events:none'>" + idea.category + "</h2>");
                $(children[2]).html("<h2 style='bottom: 0;font-size: 100%;text-align:left;margin:10%;pointer-events:none'>$" + idea.cost + "</h6>");
                
                var children = $(idea.ideaRow).children();
                //console.log(children);
                $(children[2]).text(idea.title);
                $(children[1]).text(idea.category);
                $(children[3]).text(idea.cost);

                // Add attributes to ideas.. except for pic...
                categoryMapping[ideaCategory].push(idea);
                updateCostMapping(idea, ideaCost);
                updateTitleMapping(idea, ideaTitle);

                if (ideaDescription != ""){
                    idea.updateDescription(ideaDescription);
                }
                if (ideaTags.length != 0){
                    idea.updateTags(ideaTags);
                    updateTagMapping(idea, ideaTags);
                }

                var temp = listUnion(categorieslist,tagsList);
                var searchSource = listUnion(temp,titleList);
                $('#search').autocomplete({
                    source: searchSource,
                    open: function( event, ui ) {
                        setTimeout(function(){
                            $('.ui-autocomplete').css('z-index', 9999);
                        }, 50);
                    }
                });
                
                
                var decisionBoardLeft = Number($('#decisionBoard').css('margin-left').substring(0, $('#decisionBoard').css('margin-left').length - 2));
                var boardBackgroundLeft = Number($('#ideaBoard').css('margin-left').substring(0, $('#ideaBoard').css('margin-left').length - 2));
                //console.log(boardBackgroundLeft);
                decisionLeft = decisionBoardLeft;
                ideaLeft = boardBackgroundLeft;
                
                //makeIdeaDiv(idea);

                // closing and clearing form!! :DD
                closeAndClearForm();
                ideaBeingEditted = undefined;
                updateFilter();
            }

            var makeIdeaDiv = function(idea) {

                var ideaHtml = "<div class='stickynote' unselectable='on' style='background: #" + categoryColors[idea.category][0] + "'>" +
                               "<div style='background: #" + categoryColors[idea.category][1] + ";pointer-events:none'>" +
                               "<h2 style='font-size: 125%;pointer-events:none'>" + idea.category + "</h2>" +
                               "</div>" +
                               "<h2 style='font-size: 100%;text-align:left;margin:10%;pointer-events:none'>" + idea.title + "</h6>" +
                               "<h2 style='bottom: 0;font-size: 100%;text-align:left;margin:10%;pointer-events:none'>$" + idea.cost + "</h6>" + 
                               "</div>";
                               
                var ideaDiv = $(ideaHtml);

                idea.setDiv(ideaDiv);

                ideaDiv.mousedown(stickyDown);
                
                ideaDiv.mouseup(stickyUp);
                
                ideaDiv.mousemove(stickyMove);
                
                ideaDiv.draggable(draggableObject);
                
                                var ideaRowHTML = "<tr>" +
                               "<td style='font-size: 24'> <input type='checkbox'></input> </td>" + 
                               "<td style='font-weight:bold;font-size: 24'>" + shorten(idea.category, 12) + "</td>" +
                               "<td style='font-size: 24'>" + idea.title + "</td>" +
                               "<td style='font-size: 24'>$" + idea.cost + "</td>" + 
                               //"<span style='font-size: 24'> <span style='color:red' class='glyphicon glyphicon-remove'></span> </span>" + 
                               //"<span style='font-size: 24'> <span style='color:#66CDAA' class='glyphicon glyphicon-circle-arrow-right'></span> </span>" + 
                               "</tr>";
                var ideaRow = $(ideaRowHTML);
                
                idea.ideaRow = ideaRow;
                $('#ideaBoard').append(ideaDiv);
                if(ideaViewState === 'list') {
                    $('#ideaListView').append(ideaRow);
                    ideaDiv.hide();
                }
            }

            var checkUserInputs = function(title, cost, category){
                if (title == "" | cost == "" | category == "" | category == null){
                    return false;
                } 
                if (cost != parseInt(cost, 10)){
                    return false;
                } else if (parseInt(cost,10) < 0){
                    return false;
                }
                return true;
            }

            var missingInputFeedback = function(){
                var ideaTitle = $("#ideaTitleInput").val();
                var ideaCost = $("#ideaCostInput").val();
                var ideaCategory = $("#categoryDropDown").val();

                if (ideaTitle == "" | ideaTitle == null){
                    $("#ideaTitleInput").css({"border":"1px solid red"});
                }

                if (parseInt(ideaCost, 10) != ideaCost){
                    $("#ideaCostInput").css("border","1px solid red");

                } else if (parseInt(ideaCost, 10) < 0){
                    $("#ideaCostInput").css("border","1px solid red");
                }

                if (ideaCategory == "" | ideaCategory == null){
                    $("#categoryPopover").css("border","1px solid red");
                }
            }

            var restoreBorderColor = function(){
                $("#ideaTitleInput").css("border","1px solid LightGray");
                $("#ideaCostInput").css("border","1px solid LightGray");
                $("#categoryPopover").css("border","0px solid LightGray");
            }

            var updateTagMapping = function(idea, tags){
                for(var tagIndex in tags){
                    tag = tags[tagIndex];
                    if (tag in Object.keys(tagsMapping)){
                        if (!(idea in tagsMapping[tag])){
                            tagsMapping[tag].push(idea);
                        }
                    } else {
                        tagsMapping[tag] = [idea];
                    }

                    if (!(tag in tagsList)){
                        tagsList.push(tag);
                    }
                }
            }

            var updateTitleMapping = function(idea, title){

                if (title in Object.keys(titleMapping)){
                    if(!(idea in titleMapping[title])){
                        titleMapping[title].push(idea);
                    }
                } else {
                    titleMapping[title] = [idea];
                }

                if (!(title in titleList)){
                    titleList.push(title);
                }


            }

            var updateCostMapping = function(idea, cost){
                var numberCost = parseInt(cost, 10);

                if (numberCost <= 500){
                    console.log(costMapping["lessThan500"]);
                    costMapping["lessThan500"].push(idea);
                } else if (numberCost <= 2000){
                    costMapping["500To2000"].push(idea);
                } else if (numberCost <= 5000){
                    costMapping["2000To5000"].push(idea);
                } else {
                    costMapping["moreThan5000"].push(idea);
                }
            }

            var closeAndClearForm = function(){
                $("#addStickyPopup").attr("style","display: none");
                $("#ideaTitleInput").val('');
                $("#ideaDescriptionInput").val('');
                $("#ideaCostInput").val('');
                $('#categoryDropDown').val(['']);
                $("#ideaTagInput").tagsinput("removeAll");
                
            }

            var stickyDown = function(event){
                //console.log($("#addStickyButton").css('height'));
                draggedSticky = event.currentTarget;
                //console.log(draggedSticky);
                down = {x: event.clientX, y: event.clientY, stickyLeft: Number($(draggedSticky).css('margin-left').substring(0, $(draggedSticky).css('margin-left').length - 2)), stickyTop: Number($(draggedSticky).css('margin-top').substring(0, $(draggedSticky).css('margin-top').length - 2))};
            };

            var stickyUp = function(event) {
                console.log(event);
                if(down && event.clientX === down.x && event.clientY === down.y){
                    var idea = getNonDeletedIdea(event.target);
                    console.log(idea);
                    var div = document.getElementById("ideaView");
                    div.style.display = "block";
                    $("#ideaBody").html(idea.getHtml());

                    // Edit Click Listener
                    $('.editIdeaView').click(function(event){
                        console.log("Edit!");
                        var div = document.getElementById("ideaView");
                        div.style.display = "none";
                        $("#ideaBody").html('');

                        ideaBeingEditted = idea;
                        console.log(ideaBeingEditted);
                        var popupAddSticky = document.getElementById("addStickyPopup");
                        popupAddSticky.style.display = "block";
                        
                        $("#ideaTitleInput").val(idea.getTitle());
                        //show image
                        $("#ideaDescriptionInput").val(idea.getDescription());
                        $("#ideaCostInput").val(idea.getCost());
                        document.getElementById("categoryDropDown").value = idea.getCategory();
                        var tagList = idea.getTags();
                        console.log(tagList);
                        var tagString = "";
                        for(var i = 0; i < tagList.length; i++)
                            tagString += tagList[i] + "\n";
                        $("#ideaTagInput").val(tagString);
                        $($('#addStickyPopup').children()[0]).focus();

                        $("#stickyNoteHeader").css('background-color',categoryColors[idea.getCategory()][1]);
                    });

                    // Cancel click listener
                    $('.cancelIdeaView').click(function(event){
                        console.log("CLICK!");
                        var div = document.getElementById("ideaView");
                        div.style.display = "none";
                        $("#ideaBody").html('');
                    });
                }
                //down = undefined;
            };

            var stickyMove = function(event){
                //console.log(decisionLeft);
                if(draggedSticky && down) {
                    if(page === 'home') {
                        //$(draggedSticky).css('margin-top', Math.max(0, down.stickyTop + event.clientY - down.y));
                        if($(draggedSticky).parent().attr('id') === 'ideaBoard') {
                            if(decisionLeft < Math.max(0, down.stickyLeft + event.clientX - down.x)) {
                                console.log('board changed');
                                $('#decisionBoard').append($(draggedSticky));
                                //$(draggedSticky).css('margin-left', down.stickyLeft + event.clientX - down.x - decisionLeft);
                                //$(draggedSticky).css('margin-top', Math.max(0, down.stickyTop + event.clientY - down.y));
                                var children = $(draggedSticky).children();
                                remaining -= Number($(children[2]).text().substring(1));
                                $('#budgetRemaining').text(remaining);
                            } else {
                                //$(draggedSticky).css('margin-left', Math.max(0, down.stickyLeft + event.clientX - down.x));
                            }
                        } else {
                            //console.log(down.stickyLeft + event.clientX - down.x);
                            if(down.x < decisionLeft)
                                ;//$(draggedSticky).css('margin-left', Math.max(0, down.stickyLeft + event.clientX - down.x - decisionLeft));
                            else
                                ;//$(draggedSticky).css('margin-left', Math.max(0, down.stickyLeft + event.clientX - down.x));
                        }
                    } else if(page === 'ideas') {
                        //$(draggedSticky).css('margin-top', Math.max(0, down.stickyTop + event.clientY - down.y));
                        //$(draggedSticky).css('margin-left', Math.max(0, down.stickyLeft + event.clientX - down.x));
                    } else if(page === 'decisions') {
                        //$(draggedSticky).css('margin-top', Math.max(0, down.stickyTop + event.clientY - down.y));
                        //$(draggedSticky).css('margin-left', Math.max(0, down.stickyLeft + event.clientX - down.x));
                    }
                }
            };

            var draggableObject = { 
                    cursor: "hand",
                    containment: "#boardBackground",
                    start: function(a) {
                        down = {x: event.clientX, y: event.clientY};
                        console.log(down);
                    },
                    //grid: [125, 125],
                    drag: function(e) {
                        if(page === 'home') {
                            if(decisionLeft < e.clientX - e.target.offsetWidth) {
                                $(draggedSticky).css('left', e.clientX - e.target.offsetWidth - decisionLeft);
                            } else {
                                $(draggedSticky).css('left', e.clientX - e.target.offsetWidth - ideaLeft);
                            }
                        } else if(page === 'ideas') {
                            
                        } else if(page === 'decisions') {
                            
                        }
                    },
                    stop: function(e) {
                        console.log(down.x);
                        console.log(decisionLeft, e.clientX, e.target.offsetWidth);
                        if(decisionLeft < e.clientX - e.target.offsetWidth) {
                            if(down && down.x < decisionLeft) {
                                $('#decisionBoard').append($(e.target));
                                $(draggedSticky).css('left', e.clientX - e.target.offsetWidth - decisionLeft);
                                var children = $(draggedSticky).children();
                                remaining -= Number($(children[2]).text().substring(1));
                                $('#budgetRemaining').text(remaining);
                                console.log("Decision drop");
                                var idea = getNonDeletedIdea(e.target);
                                console.log(idea);
                                var ideaIndex = ideasInIdeas.indexOf(idea);
                                ideasInIdeas.splice(ideaIndex, 1);
                                idea.ideaDiv = $(e.target);
                                if(decisionViewState === 'list') {
                                    $('#decisionListView').append(idea.ideaRow);
                                    idea.ideaDiv.hide();
                                }
                                ideasInDecisions.push(idea);
                             }
                        } else if(down && down.x > decisionLeft) {
                            console.log(e.clientX, e.target.offsetWidth, ideaLeft);
                            $('#ideaBoard').append($(e.target));
                            $(draggedSticky).css('left', e.clientX - e.target.offsetWidth - ideaLeft);
                            var children = $(draggedSticky).children();
                            remaining += Number($(children[2]).text().substring(1));
                            $('#budgetRemaining').text(remaining);
                            console.log("Idea drop");
                            var idea = getNonDeletedIdea(e.target);
                            ideasInIdeas.push(idea);
                            var ideaIndex = ideasInDecisions.indexOf(idea);
                            idea.ideaDiv = $(e.target);
                            if(ideaViewState === 'list') {
                                $('#ideaListView').append(idea.ideaRow);
                                idea.ideaDiv.hide();
                            }
                            ideasInDecisions.splice(ideaIndex, 1);
                        }
                        down = undefined;        
                        
                        updateBudgetList();
                    }

                };
            
            function load_deleted() {
                do{
                    $('#keywords').tablesorter(); 
                    $("#keywords").find('tbody').html("");
                    $("#keywords").trigger('update');
                
                    for(var i=0; i < deletedIdeas.length; i++){
                        var idea = deletedIdeas[i];
                        populate_list(idea.title, idea.category, idea.cost,idea);
                        console.log(idea.title, idea.category, idea.cost);
                    }
                    deletedInt += 1

                }while( deletedInt % 2 == 0)
                // $('#keywords').tablesorter(); 
                // $("#keywords").find('tbody').html("");
                // $("#keywords").trigger('update');
                
                // for(var i=0; i < deletedIdeas.length; i++){
                //     var idea = deletedIdeas[i];
                //     populate_list(idea.title, idea.category, idea.cost,idea);
                //     console.log(idea.title, idea.category, idea.cost);
                // }

                var deleted_frame = $('.deleted_archive_view');
                deleted_frame.css("display", "block"); 
                //$("#iframeClose").css("display", "block");
            
            }
            
            //Add row for entered item
            function populate_list(title, category, cost, idea) {
                var btn = document.createElement('button');
                btn.type = "button";
                btn.className = "btn btn-s";
                btn.value = "restore";
                btn.onclick = (function(idea) {
                    return function(){
                        
                        var $deleterow = $(btn).closest('tr');
                        $deleterow.addClass("danger");
                        $deleterow.fadeOut(500, function() {
                            $deleterow.remove();
                        });

                        restore_idea(idea);
                    }
                })(idea);
       
                $(btn).append($('<span></span>')
                    .addClass('glyphicon glyphicon-open'));
              

                $("#keywords").find('tbody')
                    .append($('<tr>')
                        .append($('<td>').attr("class", "lalign").text(title))
                        .append($('<td>').text(category))
                        .append($('<td>').text((cost)))
                        .append($('<td>').attr("id", title).attr("class", "restore_button"))
                    );

                var $row = document.getElementById(title);
                $(btn).appendTo($row.closest('td'));
            }

            //Restore idea
            function restore_idea(idea) {
                makeIdeaDiv(idea);
                idea.setVisible();
                deletedIdeas.splice(deletedIdeas.indexOf(idea),1);
                allNonDeletedIdeas.push(idea);
                ideasInIdeas.push(idea);

                categoryMapping[ideaCategory].push(idea);
                updateCostMapping(idea, parseInt(idea.getCost));
                updateTitleMapping(idea, idea.getTitle);

                var temp = listUnion(categorieslist,tagsList);
                var searchSource = listUnion(temp,titleList);
                $('#search').autocomplete({
                    source: searchSource,
                    open: function( event, ui ) {
                        setTimeout(function(){
                            $('.ui-autocomplete').css('z-index', 9999);
                        }, 50);
                    }
                });
                updateFilter();
            }

            var getNonDeletedIdea = function(sticky) {
                //console.log($(sticky).parent());
                var children = $(sticky).children();
                console.log(children);
                var title = $(children[1]).text();
                //console.log(title);
                var category = $(children[0]).text();
                for(var i = 0; i < allNonDeletedIdeas.length; i++) {
                    var idea = allNonDeletedIdeas[i];
                    if(title === idea.getTitle() && category === idea.getCategory()) {
                        return idea;
                    }
                }
            }
            
            var getNonDeletedIdeaTable = function(sticky) {
                console.log(sticky);
                //console.log($(sticky).parent());
                var children = $(sticky).parent().children();
                console.log(children);
                var title = $(children[2]).text();
                console.log(title);
                var category = $(children[1]).text();
                console.log(category);
                for(var i = 0; i < allNonDeletedIdeas.length; i++) {
                    var idea = allNonDeletedIdeas[i];console.log(idea);
                    if(title === idea.getTitle() && category === idea.getCategory()) {
                        return idea;
                    }
                }
            }
            
            var showIdea = function(idea) {
                var div = document.getElementById("ideaView");
                console.log(div.html);
                console.log(div.innerHTML);
                div.style.display = "block";
                $("#ideaBody").html(idea.getHtml());
                console.log("innerHTML");
                console.log(div.innerhtml);
            }

            var removeFromDicts = function(idea) {
                console.log('REMOVE FROM DICS');

                // delete tags mapping
                var listOfTags = idea.getTags();

                for (var tagIndex in listOfTags){
                    var tag = listOfTags[tagIndex];
                    listOfIdeasForTag = tagsMapping[tag];
                    for (var i in listOfIdeasForTag){
                        if (listOfIdeasForTag[i] == idea){
                            tagsMapping[tag].pop(idea);
                            if (tagsMapping[tag].length == 0){
                                delete tagsMapping[tag];
                                tagsList = Object.keys(tagsMapping);
                            }
                        }
                    }
                }

                // delete category mapping
                var listOfIdeasForCategory = categoryMapping[idea.getCategory()];
                for (var i in Object.keys(categoryMapping[idea.getCategory()])){
                    if (listOfIdeasForCategory == idea){
                        categoryMapping[idea.getCategory()].pop(idea);
                    }
                }

                // delete cost Mapping
                var numberCost = parseInt(idea.getCost(), 10);

                if (numberCost <= 500){
                    costMapping["lessThan500"].pop(idea);
                } else if (numberCost <= 2000){
                    costMapping["500To2000"].pop(idea);
                } else if (numberCost <= 5000){
                    costMapping["2000To5000"].pop(idea);
                } else {
                    costMapping["moreThan5000"].pop(idea);
                }

                // delete title mapping
                titleMapping[idea.getTitle()].pop(idea);
                if (titleMapping[idea.getTitle()].length == 0){
                    delete titleMapping[idea.getTitle()];
                }
            }

            
         </script>
    </head>
    <body>
        <div class="navigationbar">
            <h1><a ref="#" onclick="closeWindows(), show('home')">Simple as Love</a></h1>
            <ul class="header">
                <li id="mainpageheader"><a ref="#" onclick="show('home'), closeWindows()">Main Page</a></li>
                <li><a ref="#" onclick="show('ideas'), closeWindows()">Ideas</a></li>
                <li><a ref="#" onclick="show('decisions'), closeWindows()">Decisions</a></li>
                <li id="budget_button"><a ref="#" onclick="closeWindows(), load('budget_page')">Budget</a></li>
                <li id="archiveheader"><a ref="#" onclick="closeWindows(), load_deleted()">Archive</a></li>
                <!-- <button id="iframeClose" class="btn-default btn-danger pull-right" onclick="closeWindows()"><span class="glyphicon glyphicon-remove"></span></button> -->
            </ul>
        </div>
        <button id="iframeClose" class="pull-right btn-danger" onclick="closeWindows()"><span class="glyphicon glyphicon-remove"></span></button>
        <center><div class="h2">Jordan and Annie's Wedding</div></center>
        <div>
            <button id="filters" style="margin-bottom: 5px" class="btn">Filters <span id= "filterIcon" class="glyphicon glyphicon-menu-down"></span></button>
            <input type="text" style="margin-bottom: 20px; z-index: 1000;"  id = "search" placeholder="Search by Tag or Title"/><br>
            <div id="filterPopover" hidden>
                <!-- <input type="text" id = "search" placeholder="Search term"/><br> -->
                <h4>Categories:</h4>
                <ul id="categories">
                    <!-- <li><input type="checkbox" name="Clothing" /> Clothing </li>
                    <li><input type="checkbox" name="Entertainment" /> Entertainment </li>
                    <li><input type="checkbox" name="Flowers" /> Flowers </li>
                    <li><input type="checkbox" name="Venue" /> Venue </li>-->
                </ul>
                <h4>Cost:</h4>
                <ul id="cost">
                    <li><input type="checkbox" name="cost" id="lessThan500" />  < $500 </li>
                    <li><input type="checkbox" name="cost" id="500To2000" />  $500 - $2000 </li>
                    <li><input type="checkbox" name="cost" id="2000To5000" />  $2000 - $5000 </li>
                    <li><input type="checkbox" name="cost" id="moreThan5000" />  > $5000 </li>
                </ul>

                <input id="btnCheckAll" type="button" name="checkAll" value="Check All"/>
                <input id="btnUncheckAll" type="button" name="uncheckAll" value="Uncheck All"/>

            </div>
        </div>
        <div id="boardBackground">
            <div id='ideaBoard'>
                <a href="#" onclick="switchView('ideas')">
                    <div id="ideaHeader">
                        Ideas
                    </div>
                </a>
                <div id="ideaContent">
                    <center>
                        <button id="addStickyButton" class="btn">Add a new sticky note</button>
                    </center>
                    <table id="ideaListView" class="table table-hover">
                        
                    </table>
                </div>
                <div id="trashIcon">
                    <img id="trashPic" src="empty_trash.png">
                </div>
                <div id="moveRight">
                    <div id="moveRightIconFilling">
                        <span class="glyphicon glyphicon-arrow-right"></span>
                    </div>
                    <div id="moveRightIcon">
                        <span class="glyphicon glyphicon-circle-arrow-right"></span>
                    </div>
                 </div>
                 <div id="moveLeft">
                    <div id="moveLeftIconFilling">
                        <span class="glyphicon glyphicon-arrow-left"></span>
                    </div>
                    <div id="moveLeftIcon">
                        <span class="glyphicon glyphicon-circle-arrow-left"></span>
                    </div>
                 </div>
            </div>
            <div id='decisionBoard'>
                <a href="#" onclick="switchView('decisions')">
                    <div id="decisionHeader">
                    Decisions
                    </div>
                </a>
                <div id="decisionContent">
                    <div id="budgetTotalRemaining">
                        <a href="#" onclick="load('budget_page')">
                        Total Remaining: $<span id="budgetRemaining"></span></a>
                    </div>
                    <table id="decisionListView" class="table table-hover">
                        
                    </table>                    
                </div>            
            </div>
            <div id="addStickyPopup" class="ideaInfo" style="display: none;">
                <input type="text" id="ideaTitleInput" placeholder="Title *"/>
                <div id="dragAndDropPicUploader">
                        <div class="fallback">
                            <input name="file" type="file" multiple>
                        </div>
                </div>
                <div id="descriptionAndCost">
                    <textarea rows="4" id="ideaDescriptionInput" placeholder="Description"></textarea>
                    <input type="text" id="ideaCostInput" placeholder="Cost *"/>
                </div>
                <div id="tagsAndCategory">
                    <input type="text" id="ideaTagInput" value="" data-role="tagsinput" placeholder="Add tags" />
                    <div id="ideaCategoryPicker">
                        <div id="categoryPopover">
                            <select id="categoryDropDown" placeholder="Category">
                                <option value="" disabled selected>Select a Category*</option>
                                <option value="Cake">Cake</option>
                                <option value="Catering">Catering</option>
                                <option value="Clothing">Clothing</option>
                                <option value="Decorations">Decorations</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Flowers">Flowers</option>
                                <option value="Invitations">Invitations</option>
                                <option value="Venue">Venue</option>
                                <option value="Wedding Gifts">Wedding Gifts</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button id="saveStickyButton" class="btn">Save</button>
                <button id="cancelStickyButton" class="btn">Cancel</button>
            </div>
        </div>
        <div id='ideaView' class="ideaInfo" style="display: none;" >
            <div class="stickyNoteHeader" style='text-align:right'> 
                <button type='button' class='cancelIdeaView'>X</button>
            </div>
            <div id='ideaBody'></div>
        </div>
        <div id="budget_link" >
            <iframe id="budget_iframe" src="budget.html" seamless></iframe>
        </div>
        <div id="wrapper" class="deleted_archive_view">
            <h2 style="font-family: Sacramento">Deleted Archive</h2>
            <table id="keywords" cellspacing="0" cellpadding="0" class="tablesorter">
                <thead>
                    <tr>
                        <th><span>Title</span></th>
                        <th><span>Category</span></th>
                        <th><span>Cost</span></th>
                        <th>Restore?</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </body>
</html>