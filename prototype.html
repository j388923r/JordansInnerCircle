<html>
    <head>
        <title>Simple As Love</title>
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

        <!-- Fonts -->
        <link href="http://fonts.googleapis.com/css?family=Oleo+Script" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Great+Vibes" rel="stylesheet" type="text/css">
        
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

        <link rel="stylesheet" href="mainLayout.css">

        <script type="text/javascript" src="jquery/js/jquery-ui-1.10.0.custom.min.js"></script>

        <!-- Deeclaring global budget variables -->
        <script type='text/javascript' > 
          total_budget = 4000; //Dummy data to set total budget to initial value
          remaining = 4000; 
        </script>
        
        <!--<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
        <script src="//code.jquery.com/jquery-1.10.2.js"></script>
        <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>-->
        
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

        <!-- For drag and drop uploader -->
        <script type="text/javascript" src="dropzone.js"></script>
        <link rel="stylesheet" type="text/css" href="dropzone.css" />

        <script type="text/javascript" src="Idea.js"></script>
        
        <!-- For Cool Tagging -->
        <script type="text/javascript" src="bootstrap-tagsinput/bootstrap-tagsinput.js"></script>
        <link rel="stylesheet" type="text/css" href="bootstrap-tagsinput/bootstrap-tagsinput.css"/>

        <script type="text/javascript" src="js/jquery.tablesorter.min.js"></script>

        <script>

            var costMapping = {'lessThan500':[], '500To2000':[], '2000To5000':[], 'moreThan5000': []};
            var categoryMapping = {'Clothing':[], 'Entertainment':[],'Flowers':[], 'Venue':[], 'Catering':[], 'Invitations':[], 'Other':[]};
            var tagsMapping = {'vegas':[], 'prince':[]};
            var titleMapping = {};

            var categorieslist = ["Clothing","Entertainment","Flowers","Venue", "Catering", "Invitations", "Other"];
            var tagsList = ["vegas", "prince"];
            var costList = ["less than 500", "500 to 2000", "2001 to 5000", "more than 5000"];
            var costListForCheckAll = ['lessThan500', '500To2000', '2000To5000', 'moreThan5000'];
            var titleList = [];

            var costFilters = [];
            var categoryFilters = [];
            var tagFilters = [];

            var allNonDeletedIdeas = [];
            var deletedIdeas = [];
            var ideasInIdeas = [];
            var ideasInDecisions = [];

            var isAllChecked = false;
            var checked_arr = [];
            
            var page = 'home';
            var decisionLeft;
            var down = undefined;
            var draggedSticky = undefined;

            var ideasToShow = [];

            var searchedFor = "";

            $(document).ready(function(){
                var ideaBoard = document.getElementById('ideaBoard');
                
                var decisionBoardLeft = Number($('#decisionBoard').css('margin-left').substring(0, $('#decisionBoard').css('margin-left').length - 2));
                var boardBackgroundLeft = Number($('#ideaBoard').css('margin-left').substring(0, $('#ideaBoard').css('margin-left').length - 2));
                //console.log(boardBackgroundLeft);
                var decisionLeft = decisionBoardLeft - boardBackgroundLeft;
                var decisionBoard = document.getElementById('decisionBoard');
                var first =  document.getElementById('lessThan500');
                var second = document.getElementById('500To2000');
                var third = document.getElementById('2000To5000');
                var fourth = document.getElementById('moreThan5000');
                
                document.getElementById("budgetRemaining").innerHTML = remaining;


                var temp = listUnion(categorieslist,tagsList);
                var searchSource = listUnion(temp,costList);

                var editIdea = false;
                var edittableIdea = undefined;

                first.addEventListener("change", checkboxChange);
                second.addEventListener("change", checkboxChange);
                third.addEventListener("change", checkboxChange);
                fourth.addEventListener("change", checkboxChange);


                buildFilter(categorieslist, tagsList); //change to names
                $('[data-toggle="popover"]').popover({
                    placement : 'bottom',
                    content : '<input type="text" placeholder="Filter term"/>'
                });
                
                $('#filters').click(function() {
                    var categories = document.getElementById("filterPopover");
                    categories.hidden = !categories.hidden;
                    buildFilter(categorieslist, tagsList); //change to names
                });

                $('#btnCheckAll').click(function() {
                    isAllChecked = true;
                    checkAll();
                });

                $('#btnUncheckAll').click(function() {
                    uncheckAll();
                    isAllChecked = false;
                });

                $('#search').keyup(function(e) {
                    if (e.keyCode == 13){
                        var input = $("#search");
                        var inputValue = $(input).val();
                        //console.log(inputValue);
                        searching(inputValue);
                    }
                });


                $('#search').autocomplete({
                    source: searchSource

                });
                $("#search").autocomplete( "option", "autoFocus", false );
                $("#search").autocomplete( "option", "minLength", 1 );
                $("#search").autocomplete( "option", "delay", 0);

                $('#search').change(function() {
                    var input = $("#search");
                    var inputValue = $(input).val();
                    if(inputValue == ""){
                        clearing();
                    }
                });
                
                $('.stickynote').mousedown(stickyDown);
                
                $('.stickynote').mouseup(stickyUp);
                
                $('.stickynote').mousemove(stickyMove);
                
                $('.stickynote').draggable({
                    start: function(a) {
                        console.log(a);
                    },
                    drag: function(a) {
                        console.log(a);
                    },
                    stop: function(a) {
                        console.log(a);
                    }
                });
                
                $('#ideaBoard, #decisionBoard').mouseleave(function(event) {
                    down = undefined;
                    //console.log(down);
                });

                $('#addIdeaButton').click(function(){
                    var popupIdea = document.getElementById("ideaPopup");
                    popupIdea.style.display = 'block';
                    console.log("ADD IDEA BUTTON!!")

                    if (editIdea){
                        $('#ideaTitleInput').val(idea.getTitle());
                        $('#ideaCostInput').val(idea.getCost());
                        $("#categoryDropDown").val([idea.getCategory()]);
                        $("#ideaDescriptionInput").val(idea.getDescription());
                        var tags = idea.getTags();

                        for (var tagIndex in tags){
                            $("#ideaTagInput").tagsinput("add", tags[tagIndex]);
                        }
                    }
                });

                $('#cancelIdeaButton').click(function(){
                    restoreBorderColor();
                    closeAndClearForm();
                })

                $('#saveIdeaButton').click(function(){
                    //console.log(true);
                    if (!editIdea){
                        createNewIdea();
                    } else {
                        updateIdea(edittableIdea);
                    }

                });
                
                $('#trashIcon').mouseup(function(event) {
                    //console.log($(draggedSticky));
                    if(draggedSticky && down) {
                        down = undefined;
                        var children = $(draggedSticky).children();
                        var idea = new Idea($(children[1]).text(), $(children[0]).text(), Number($(children[2]).text().substring(1)));
                        $(draggedSticky).remove();
                        for(var i = 0; i < allNonDeletedIdeas.length; i++) {
                            var ideaToDelete = allNonDeletedIdeas[i];
                            if(ideaToDelete.getTitle() === $(children[1]).text() && ideaToDelete.getCategory() === $(children[0]).text()) {
                                allNonDeletedIdeas.splice(i, 1);
                                break;
                            }
                        }
                        for(var i = 0; i < ideasInIdeas.length; i++) {
                            var ideaToDelete = ideasInIdeas[i];
                            if(ideaToDelete.getTitle() === $(children[1]).text() && ideaToDelete.getCategory() === $(children[0]).text()) {
                                ideasInIdeas.splice(i, 1);
                                break;
                            }
                        }

                        // deletedItems.push(idea);

                        deletedIdeas.push(idea);
                    }
                });
            });

            //function that takes in categories and tags list and contructs the filter 
            //do we want to do cost filtering dynamically or have set intervals

            var buildFilter = function(cat_arr, tag_arr) {
                var temp = listUnion(categorieslist,tagsList);
                var searchSource = listUnion(temp,costList);
                cat_arr.sort();
                tag_arr.sort();
                $("#categories").html("");
                $("#tags").html("");
                for (var i = 0; i < cat_arr.length; i++) {
                    var cat = cat_arr[i];
                    var newCat = document.createElement("input");
                    newCat.type = "checkbox";
                    newCat.name = "cat";
                    newCat.id = cat;
                    newCat.onchange = checkboxChange;
                    
                    newCat.checked = isAllChecked;

                    for(var j = 0; j < checked_arr.length; j++){
                        if(checked_arr[j] == cat){
                            newCat.checked = true;
                        }
                    }

                    var newList = document.createElement("li");

                    $(newList).append(newCat);
                    $(newList).append("  " + cat);
                    // var newString = "<li><input type=\"checkbox\" name="+ cat+" />  " + cat+ "</li>"; //might need to change to allow addition of event listeners
                    $("#categories").append(newList);
                };
                for (var i = 0; i < tag_arr.length; i++) {
                    var tag = tag_arr[i];
                    var newTag = document.createElement("input");
                    newTag.type = "checkbox";
                    newTag.name = "tag";
                    newTag.id = tag;
                    
                    newTag.checked = isAllChecked;
                    newTag.onchange = checkboxChange;

                    for(var j = 0; j < checked_arr.length; j++){
                        if(checked_arr[j] == tag){
                            newTag.checked = true;
                        }
                    }

                    var newList = document.createElement("li");

                    $(newList).append(newTag);
                    $(newList).append("  " + tag);
                    // var newString = "<li><input type=\"checkbox\" name="+ tag+" />  " + tag+ "</li>";
                    $("#tags").append(newList);
                };
            }

            var checkAll = function() {
                var boxes = document.getElementsByTagName('input');
                for(var i = 0; i< boxes.length; i++){
                    if(boxes[i].type == 'checkbox') {
                        boxes[i].checked = true;
                    }
                }
                for(var i = 0; i < categorieslist.length; i++) {
                    categoryFilters.push(categorieslist[i]);
                }
                for(var i = 0; i < tagsList.length; i++) {
                    tagFilters.push(tagsList[i]);
                }
                for(var i = 0; i < costListForCheckAll.length; i++) {
                    costFilters.push(costListForCheckAll[i]);
                }
                updateFilter();
            }

            var uncheckAll = function() {
                var boxes = document.getElementsByTagName('input');
                for(var i = 0; i< boxes.length; i++){
                    if(boxes[i].type == 'checkbox') {
                        boxes[i].checked = false;
                        checked_arr = []

                    }
                }
                categoryFilters = [];
                tagFilters = [];
                costFilters = [];
                updateFilter();

            }

            var checkboxChange = function() {
                if(this.checked){
                    checked_arr.push(this.id);
                    //console.log(this.name);
                    if(this.name == "cat"){
                        categoryFilters.push(this.id);
                    }
                    else if(this.name == "cost"){
                        costFilters.push(this.id);
                    }
                    else {
                        tagFilters.push(this.id);
                    }
                }
                else{
                    //console.log("remove filter")
                    for(var i = 0; i < checked_arr.length; i++){
                        if(checked_arr[i]== this.id){
                            checked_arr.splice(i,1);
                        }
                    }
                    if(this.name == "cat"){
                        for(var i = 0; i < categoryFilters.length; i++){
                            if(categoryFilters[i]== this.id){
                                categoryFilters.splice(i,1);
                            }
                        }
                    }
                    else if(this.name == "cost"){
                        for(var i = 0; i < costFilters.length; i++){
                            if(costFilters[i]== this.id){
                                costFilters.splice(i,1);
                            }
                        }
                    }
                    else {

                        for(var i = 0; i < tagFilters.length; i++){
                            if(tagFilters[i]== this.id){
                                tagFilters.splice(i,1);
                            }
                        }
                    }

                }
                updateFilter();
            }

            var updateFilter = function() {
                var costset = [];
                var catset = [];
                var tagset = [];
                ideasToShow = [];
                for(var i = 0; i< costFilters.length; i++){
                    costset = listUnion(costset,costMapping[costFilters[i]]);
                }

                for(var i = 0; i< tagFilters.length; i++){
                    tagset = listUnion(tagset, tagsMapping[tagFilters[i]]);
                }
                for(var i = 0; i< categoryFilters.length; i++){
                    catset = listUnion(catset, categoryMapping[categoryFilters[i]]);
                }
                //console.log("start sets");
                if(costFilters.length == 0){
                    costset = allNonDeletedIdeas;
                }
                if(tagFilters.length == 0){
                    tagset = allNonDeletedIdeas;
                }
                if(categoryFilters.length == 0 ) {
                    catset = allNonDeletedIdeas;
                }

                var temp_arr = listInter(catset, costset);
                ideasToShow = listInter(temp_arr, tagset);

                // console.log("ideasToShow");
                // console.log(ideasToShow);

                // console.log("allNonDeletedIdeas");
                // console.log(allNonDeletedIdeas);

                // console.log("cost dict");
                // console.log(costMapping);

                for(var i = 0; i < allNonDeletedIdeas.length; i++){
                    //not sure how to hide an idea but trying to do that here
                    allNonDeletedIdeas[i].hide();
                }
                for(var i = 0; i< ideasToShow.length; i++){
                    ideasToShow[i].setVisible();
                }

            }


            var searching = function(term) {
                var term = term;
                for(var i= 0; i< costList.length; i++){
                    if(term == costList[i]){
                        searchedFor = costListForCheckAll[i];
                        ideasToShow = listInter(ideasToShow, costMapping[costListForCheckAll[i]]);
                    }
                }
                for(var i = 0; i< tagsList.length; i++ ){
                    if(term == tagsList[i]){
                        searchedFor = tagsList[i];
                        ideasToShow = listInter(ideasToShow, tagsMapping[tagsList[i]]);
                    }
                }
                for(var i = 0; i< categorieslist.length; i++){
                    if(term == categorieslist[i]){
                        searchedFor = categorieslist[i];
                        ideasToShow = listInter(ideasToShow, categoryMapping[categorieslist[i]]);
                    }
                }

                for(var i = 0; i < allNonDeletedIdeas.length; i++){
                    //not sure how to hide an idea but trying to do that here
                    allNonDeletedIdeas[i].hide();
                }
                for(var i = 0; i< ideasToShow.length; i++){
                    //console.log(ideasToShow);
                    ideasToShow[i].setVisible();
                }

            }

            var clearing = function(){
                updateFilter();
                searchedFor = "";
            }

            var listUnion = function(list1, list2) {
                var retList = [];
                var list1 = list1;
                for(var i = 0; i< list1.length; i++){
                    retList.push(list1[i]);
                }
                var list2 = list2;
                for(var i = 0; i < list2.length; i++){
                    var inRetList = false;
                    for(var j = 0; j < retList.length; j++){
                        if(list2[i] == retList[j]){
                            inRetList = true;
                        }
                    }
                    if(!inRetList){
                        retList.push(list2[i]);
                    }
                }
                return retList;
            }

            var listInter = function(list1, list2) {
                var retList = [];
                var list1 = list1;
                var list2 = list2;
                for(var i = 0; i < list1.length; i++){
                    var matched = false;
                    for(var j = 0; j < list2.length; j++){
                        if(list1[i] == list2[j]){
                            matched = true;
                        }
                    }
                    if(matched){
                        retList.push(list1[i]);
                    }
                }
                return retList;
            }

            var stringContains = function(that) {
                return this.indexOf(that) > -1;
            }
            
            var show = function(boardName) {
                page = boardName;
                if(boardName === 'ideas') {
                    $('#ideaBoard').show();
                    $('#ideaBoard').css('width', '94%');
                    $('#ideaBoard').css('margin-left', '3%');
                    $('#ideaHeader').css('margin-left', '38%');
                    $('#decisionBoard').hide();
                } else if(boardName === 'decisions') {
                    $('#decisionBoard').show();
                    $('#decisionBoard').css('width', '94%');
                    $('#decisionBoard').css('margin-left', '3%');
                    $('#decisionHeader').css('margin-left', '38%');
                    $('#ideaBoard').hide();
                } else {
                    $('#decisionBoard, #ideaBoard').show();
                    $('#decisionBoard, #ideaBoard').css('width', '45%');
                    $('#decisionBoard').css('margin-left', '52%');
                    $('#decisionHeader, #ideaHeader').css('margin-left', '15.5%');
                }
            };

            var load = function(page_name) {
                if(page_name === 'budget_page') {
                    var iframe = $('#budget_iframe');
                    iframe.css("display", "block");
                    $("#iframeClose").css("display", "block");
                    //iframe.css({"height":"400", "width":"800", "border":"none"});

                    }
            }

            function closeWindows() {
                
                var iframe = $('#budget_iframe');
                iframe.css("display", "none");
                $("#iframeClose").css("display", "none");

                //Global function to set remaining budget the same
                (function (global) {
                    document.getElementById("budgetRemaining").innerHTML = global.localStorage.getItem("shared_remaining_budget");
                    console.log("GLOBAL", global.localStorage.getItem("shared_remaining_budget"));
                }(window));


                var deleted_frame = $('.deleted_archive_view');
                deleted_frame.css("display", "none"); 
                $("#iframeClose").css("display", "none");

            }

            var createIdeaDisplay = function(idea) {
                var idea = idea;
                console.log("make idea pop up");
                var pictures = idea.getPictures();
                var title = idea.getTitle();
                var category = idea.getCategory();
                var description = idea.getDescription();
                var tags = idea.getTags();
                var cost = idea.getCost();

            }

            var createNewIdea = function(){
                restoreBorderColor();

                ideaTitle = $('#ideaTitleInput').val();
                ideaCost = $('#ideaCostInput').val();
                ideaCategory = $("#categoryDropDown").val();
                ideaPics = $("#picUploader").context.URL;
                console.log(ideaPics);
                ideaDescription = $("#ideaDescriptionInput").val();
                ideaTags = $("#ideaTagInput").tagsinput("items");

                var validIdea = checkUserInputs(ideaTitle, ideaCost, ideaCategory);
                console.log(validIdea);
                if (!validIdea){
                    missingInputFeedback();
                    return;
                }
                
                var idea = new Idea(ideaTitle, ideaCategory, ideaCost);

                // Add attributes to ideas.. except for pic...
                categoryMapping[ideaCategory].push(idea);
                updateCostMapping(idea, ideaCost);
                if (ideaDescription != ""){
                    idea.updateDescription(ideaDescription);
                }
                if (ideaTags.length != 0){
                    idea.updateTags(ideaTags);
                    updateTagMapping(idea, ideaTags);
                }

                allNonDeletedIdeas.push(idea);
                ideasInIdeas.push(idea);
                
                var decisionBoardLeft = Number($('#decisionBoard').css('margin-left').substring(0, $('#decisionBoard').css('margin-left').length - 2));
                var boardBackgroundLeft = Number($('#ideaBoard').css('margin-left').substring(0, $('#ideaBoard').css('margin-left').length - 2));
                //console.log(boardBackgroundLeft);
                decisionLeft = decisionBoardLeft - boardBackgroundLeft;
                
                console.log(true);
                
                var ideaHtml = "<div class='stickynote' unselectable='on'>" +
                               "<h5 style='font-weight:bold;font-size: 24'>" + idea.category + "</h5>" +
                               "<h6 style='font-size: 24'>" + idea.title + "</h6>" +
                               "<h6 style='bottom: 0;font-size: 24'>$" + idea.cost + "</h6>" + 
                               "</div>";
                               
                var ideaDiv = $(ideaHtml);

                idea.setDiv(ideaDiv);

                //ideaDiv.mousedown(stickyDown);
                
                //ideaDiv.mouseup(stickyUp);
                
                ideaDiv.mousemove(stickyMove);
                
                ideaDiv.draggable({ 
                    cursor: "hand",
                    start: function(a) {
                        console.log(a);
                    },
                    drag: function(a) {
                        console.log(a);
                    },
                    stop: function(a) {
                        console.log(a);
                    }
                });
                $('#ideaBoard').append(ideaDiv);

                // Listener to see event
                ideaDiv.dblclick(function(event){
                    var div = document.getElementById("ideaView");
                    div.style.display = "block";
                    $("#ideaView").html(idea.getHtml());
                    console.log("double clikc");

                    // Edit Click Listener
                    $('.editIdeaView').click(function(event){
                        console.log("Edit!");
                        var div = document.getElementById("ideaView");
                        div.style.display = "none";
                        $("ideaView").html('');

                        editIdea = true;
                        edittableIdea = idea;
                        var popupIdea = document.getElementById("ideaPopup");
                        popupIdea.style.display = "block";
                        
                        $("#ideaTitleInput").val(idea.getTitle());
                        //show image
                        $("#ideaDescriptionInput").val(idea.getDescription());
                        $("#ideaCostInput").val(idea.getCost());
                        $("#categoryDropDown").val(idea.getCategory());
                        var tagList = idea.getTags();
                        var tagString = "";
                        for(var i = 0; i < tagList.length; i++)
                            tagString += tagList[i] + " ";
                        $("#ideaTagInput").val(tagString);
                        
                    });

                    // Cancel click listener
                    $('.cancelIdeaView').click(function(event){
                        console.log("CLICK!");
                        var div = document.getElementById("ideaView");
                        div.style.display = "none";
                        $("ideaView").html('');
                    });
                });

                // closing and clearing form!! :DD
                closeAndClearForm();


            }

            var updateIdea = function(idea){
                restoreBorderColor();

                ideaTitle = $('#ideaTitleInput').val();
                ideaCost = $('#ideaCostInput').val();
                ideaCategory = $("#categoryDropDown").val();
                ideaPics = $("#picUploader").context.URL;
                ideaDescription = $("#ideaDescriptionInput").val();
                ideaTags = $("#ideaTagInput").tagsinput("items");

                var validIdea = checkUserInputs(ideaTitle, ideaCost, ideaCategory);
                console.log(validIdea);
                if (!validIdea){
                    missingInputFeedback();
                    return;
                }

                idea.updateTitle(ideaTitle);
                idea.updateCost(ideaCost);
                idea.updateCategory(ideaCategory);

                // Add attributes to ideas.. except for pic...
                categoryMapping[ideaCategory].push(idea);
                updateCostMapping(idea, ideaCost);
                if (ideaDescription != ""){
                    idea.updateDescription(ideaDescription);
                }
                if (ideaTags.length != 0){
                    idea.updateTags(ideaTags);
                    updateTagMapping(idea, ideaTags);
                }
                
                var decisionBoardLeft = Number($('#decisionBoard').css('margin-left').substring(0, $('#decisionBoard').css('margin-left').length - 2));
                var boardBackgroundLeft = Number($('#ideaBoard').css('margin-left').substring(0, $('#ideaBoard').css('margin-left').length - 2));
                //console.log(boardBackgroundLeft);
                decisionLeft = decisionBoardLeft - boardBackgroundLeft;
                
                var ideaHtml = "<div class='stickynote' unselectable='on'>" +
                               "<h5 style='font-weight:bold;font-size: 24'>" + idea.category + "</h5>" +
                               "<h6 style='font-size: 24'>" + idea.title + "</h6>" +
                               "<h6 style='bottom: 0;font-size: 24'>$" + idea.cost + "</h6>" + 
                               "</div>";
                               
                var ideaDiv = $(ideaHtml);

                idea.setDiv(ideaDiv);

                ideaDiv.mousedown(stickyDown);
                
                ideaDiv.mouseup(stickyUp);
                
                ideaDiv.mousemove(stickyMove);
                $('#ideaBoard').append(ideaDiv);

                // Listener to see event
                ideaDiv.dblclick(function(event){
                    var div = document.getElementById("ideaView");
                    div.style.display = "block";
                    $("#ideaView").html(idea.getHtml());
                    console.log("double clikc");

                    // Edit Click Listener
                    $('.editIdeaView').click(function(event){
                        console.log("Edit!");
                        var div = document.getElementById("ideaView");
                        div.style.display = "none";
                        $("ideaView").html('');

                        editIdea = true;
                        edittableIdea = idea;
                        var popupIdea = document.getElementById("ideaPopup");
                        popupIdea.style.display = "block";
                        
                        $("#ideaTitleInput").val(idea.getTitle());
                        //show image
                        $("#ideaDescriptionInput").val(idea.getDescription());
                        $("#ideaCostInput").val(idea.getCost());
                        document.getElementById("categoryDropDown").value = idea.getCategory();
                        var tagList = idea.getTags();
                        var tagString = "";
                        for(var i = 0; i < tagList.length; i++)
                            tagString += tagList[i] + " ";
                        $("#ideaTagInput").val(tagString);
                    });

                    // Cancel click listener
                    $('.cancelIdeaView').click(function(event){
                        console.log("CLICK!");
                        var div = document.getElementById("ideaView");
                        div.style.display = "none";
                        $("ideaView").html('');
                    });
                });

                // closing and clearing form!! :DD
                closeAndClearForm();
                edittableIdea = undefined;
                editIdea = false;
            }

            var makeIdeaDiv = function(idea) {

                var ideaHtml = "<div class='stickynote' unselectable='on'>" +
               "<h5 style='font-weight:bold;font-size: 24'>" + idea.category + "</h5>" +
               "<h6 style='font-size: 24'>" + idea.title + "</h6>" +
               "<h6 style='bottom: 0;font-size: 24'>$" + idea.cost + "</h6>" + 
               "</div>";
                               
                var ideaDiv = $(ideaHtml);

                idea.setDiv(ideaDiv);

                ideaDiv.mousedown(stickyDown);
                
                ideaDiv.mouseup(stickyUp);
                
                ideaDiv.mousemove(stickyMove);
                $('#ideaBoard').append(ideaDiv);

                ideaDiv.dblclick(function(event){
                    var div = document.getElementById("ideaView");
                    div.style.display = "block";
                    $("#ideaView").html(idea.getHtml());
                    console.log("DOUBLE CLIKC");

                    // Edit Click Listener
                    $('.editIdeaView').click(function(event){
                        console.log("Edit!");
                        var div = document.getElementById("ideaView");
                        div.style.display = "none";
                        $("ideaView").html('');

                        editIdea = true;
                        edittableIdea = idea;
                        var popupIdea = document.getElementById("ideaPopup");
                        popupIdea.style.display = "block";
                    });

                    // Cancel click listener
                    $('.cancelIdeaView').click(function(event){
                        console.log("CLICK!");
                        var div = document.getElementById("ideaView");
                        div.style.display = "none";
                        $("ideaView").html('');

                    });
                });
            }

            var checkUserInputs = function(title, cost, category){
                if (title == "" | cost == "" | category == "" | category == null){
                    return false;
                } 
                if (cost != parseInt(cost, 10)){
                    return false;
                } else if (parseInt(cost,10) < 0){
                    return false;
                }
                return true;
            }

            var missingInputFeedback = function(){
                var ideaTitle = $("#ideaTitleInput").val();
                var ideaCost = $("#ideaCostInput").val();
                var ideaCategory = $("#categoryDropDown").val();

                if (ideaTitle == "" | ideaTitle == null){
                    $("#ideaTitleInput").css({"border":"1px solid red"});
                }

                if (parseInt(ideaCost, 10) != ideaCost){
                    $("#ideaCostInput").css("border","1px solid red");

                } else if (parseInt(ideaCost, 10) < 0){
                    $("#ideaCostInput").css("border","1px solid red");
                }

                if (ideaCategory == "" | ideaCategory == null){
                    $("#ideaCategoryPicker").css("border","1px solid red");
                }
            }

            var restoreBorderColor = function(){
                $("#ideaTitleInput").css("border","1px solid black");
                $("#ideaCostInput").css("border","1px solid black");
                $("#ideaCategoryPicker").css("border","1px solid black");
            }

            var updateTagMapping = function(idea, tags){
                for(var tagIndex in tags){
                    tag = tags[tagIndex];
                    if (tag in Object.keys(tagsMapping)){
                        if (!(idea in tagsMapping[tag])){
                            tagsMapping[tag].push(idea);
                        }
                    } else {
                        tagsMapping[tag] = [idea];
                    }

                    if (!(tag in tagsList)){
                        tagsList.push(tag);
                    }
                }
            }

            var updateCostMapping = function(idea, cost){
                var numberCost = parseInt(cost, 10);

                if (numberCost <= 500){
                    console.log(costMapping["lessThan500"]);
                    costMapping["lessThan500"].push(idea);
                } else if (numberCost <= 2000){
                    costMapping["500To2000"].push(idea);
                } else if (numberCost <= 5000){
                    costMapping["2000To5000"].push(idea);
                } else {
                    costMapping["moreThan5000"].push(idea);
                }
            }

            var closeAndClearForm = function(){
                $("#ideaPopup").attr("style","display: none");
                $("#ideaTitleInput").val('');
                $("#ideaDescriptionInput").val('');
                $("#ideaCostInput").val('');
                $("#categoryDropDown").val(['Select a Category*']);
                $("#ideaTagInput").tagsinput("removeAll");
                
            }

            var stickyDown = function(event){
                //console.log($("#addIdeaButton").css('height'));
                draggedSticky = event.currentTarget;
                //console.log(draggedSticky);
                down = {x: event.clientX, y: event.clientY, stickyLeft: Number($(draggedSticky).css('margin-left').substring(0, $(draggedSticky).css('margin-left').length - 2)), stickyTop: Number($(draggedSticky).css('margin-top').substring(0, $(draggedSticky).css('margin-top').length - 2))};
            };

            var stickyUp = function(event) {
                console.log(event);
                if(event.clientX === down.x && event.clientY === down.y){
                    var idea = getNonDeletedIdea(draggedSticky);
                    var div = document.getElementById("ideaView");
                    div.style.display = "block";
                    $("#ideaView").html(idea.getHtml());
                    console.log("double clikc");

                    // Edit Click Listener
                    $('.editIdeaView').click(function(event){
                        console.log("Edit!");
                        var div = document.getElementById("ideaView");
                        div.style.display = "none";
                        $("ideaView").html('');

                        editIdea = true;
                        edittableIdea = idea;
                        var popupIdea = document.getElementById("ideaPopup");
                        popupIdea.style.display = "block";
                        
                        $("#ideaTitleInput").val(idea.getTitle());
                        //show image
                        $("#ideaDescriptionInput").val(idea.getDescription());
                        $("#ideaCostInput").val(idea.getCost());
                        document.getElementById("categoryDropDown").value = idea.getCategory();
                        var tagList = idea.getTags();
                        console.log(tagList);
                        var tagString = "";
                        for(var i = 0; i < tagList.length; i++)
                            tagString += tagList[i] + "\n";
                        $("#ideaTagInput").val(tagString);
                    });

                    // Cancel click listener
                    $('.cancelIdeaView').click(function(event){
                        console.log("CLICK!");
                        var div = document.getElementById("ideaView");
                        div.style.display = "none";
                        $("ideaView").html('');
                    });
                }
                down = undefined;
            };

            var stickyMove = function(event){
                //console.log(decisionLeft);
                if(draggedSticky && down) {
                    if(page === 'home') {
                        $(draggedSticky).css('margin-top', Math.max(0, down.stickyTop + event.clientY - down.y));
                        if($(draggedSticky).parent().attr('id') === 'ideaBoard') {
                            if(decisionLeft < Math.max(0, down.stickyLeft + event.clientX - down.x)) {
                                console.log('board changed');
                                $('#decisionBoard').append($(draggedSticky));
                                $(draggedSticky).css('margin-left', down.stickyLeft + event.clientX - down.x - decisionLeft);
                                $(draggedSticky).css('margin-top', Math.max(0, down.stickyTop + event.clientY - down.y));
                                $(draggedSticky).css('border', 'solid 3px #614126');
                                var children = $(draggedSticky).children();
                                remaining -= Number($(children[2]).text().substring(1));
                                $('#budgetRemaining').text(remaining);
                            } else {
                                $(draggedSticky).css('margin-left', Math.max(0, down.stickyLeft + event.clientX - down.x));
                            }
                        } else {
                            //console.log(down.stickyLeft + event.clientX - down.x);
                            if(down.x < decisionLeft)
                                $(draggedSticky).css('margin-left', Math.max(0, down.stickyLeft + event.clientX - down.x - decisionLeft));
                            else
                                $(draggedSticky).css('margin-left', Math.max(0, down.stickyLeft + event.clientX - down.x));
                        }
                    } else if(page === 'ideas') {
                        $(draggedSticky).css('margin-top', Math.max(0, down.stickyTop + event.clientY - down.y));
                        $(draggedSticky).css('margin-left', Math.max(0, down.stickyLeft + event.clientX - down.x));
                    } else if(page === 'decisions') {
                        $(draggedSticky).css('margin-top', Math.max(0, down.stickyTop + event.clientY - down.y));
                        $(draggedSticky).css('margin-left', Math.max(0, down.stickyLeft + event.clientX - down.x));
                    }
                }
            };

            function load_deleted() {
                
                for(var i=0; i < deletedIdeas.length; i++){
                    var idea = deletedIdeas[i];
                    populate_list(idea.title, idea.category, idea.cost,idea);
                    console.log(idea.title, idea.category, idea.cost);
                }

                var deleted_frame = $('.deleted_archive_view');
                deleted_frame.css("display", "block"); 
                $("#iframeClose").css("display", "block");
            
                $('#keywords').tablesorter(); 

            }
            
            //Add row for entered item
            function populate_list(title, category, cost, idea) {
                var btn = document.createElement('button');
                btn.type = "button";
                btn.className = "btn btn-s";
                btn.value = "restore";
                btn.onclick = (function(idea) {
                    return function(){
                        
                        var $deleterow = $(btn).closest('tr');
                        $deleterow.addClass("danger");
                        $deleterow.fadeOut(500, function() {
                            $deleterow.remove();
                        });

                        restore_idea(idea);
                    }
                })(idea);
       
                $(btn).append($('<span></span>')
                    .addClass('glyphicon glyphicon-open'));
              

                $("#keywords").find('tbody')
                    .append($('<tr>')
                        .append($('<td>').attr("class", "lalign").text(title))
                        .append($('<td>').text(category))
                        .append($('<td>').text((cost)))
                        .append($('<td>').attr("id", title).attr("class", "restore_button"))
                    );

                var $row = document.getElementById(title);
                $(btn).appendTo($row.closest('td'));
            }

            //Restore idea
            function restore_idea(idea) {
                makeIdeaDiv(idea);
                idea.setVisible();
                deletedIdeas.splice(deletedIdeas.indexOf(idea),1);
                allNonDeletedIdeas.push(idea);
                ideasInIdeas.push(idea);
                updateFilter();
            }

            var getNonDeletedIdea = function(sticky) {
                var children = $(draggedSticky).children();
                var title = $(children[1]).text();
                var category = $(children[0]).text();
                for(var i = 0; i < allNonDeletedIdeas.length; i++) {
                    var idea = allNonDeletedIdeas[i];
                    if(title === idea.getTitle() && category === idea.getCategory()) {
                        return idea;
                    }
                }
            }
            
            var showIdea = function(idea) {
                var div = document.getElementById("ideaView");
                console.log(div.html);
                console.log(div.innerHTML);
                div.style.display = "block";
                div.innerhtml = idea.getHtml();
                $("#ideaView").html(idea.getHtml());
                console.log("innerHTML");
                console.log(div.innerhtml);
            }
         </script>
    </head>
    <body>
        <div class="navigationbar">
            <h1><a ref="#" onclick="show('home')">Simple as Love</a></h1>
            <ul class="header">
                <li id="mainpageheader"><a ref="#" onclick="show('home')">Main Page</a></li>
                <li><a ref="#" onclick="show('ideas')">Ideas</a></li>
                <li><a ref="#" onclick="show('decisions')">Decisions</a></li>
                <li><a ref="#" onclick="load('budget_page')">Budget</a></li>
                <li id="archiveheader"><a ref="#" onclick="load_deleted()">Archive</a></li>
            </ul>
            <button id="iframeClose" class="pull-right btn-danger" onclick="closeWindows()"><span class="glyphicon glyphicon-remove"></span></button>
        </div>
        <div>
            <button id="filters" style="margin-bottom: 5px" class="btn">Filters <span class="glyphicon glyphicon-menu-down"></span></button>
            <div id="filterPopover" hidden>
                <input type="text" id = "search" placeholder="Search term"/><br>
                <h4>Categories:</h4>
                <ul id="categories">
                    <!-- <li><input type="checkbox" name="Clothing" /> Clothing </li>
                    <li><input type="checkbox" name="Entertainment" /> Entertainment </li>
                    <li><input type="checkbox" name="Flowers" /> Flowers </li>
                    <li><input type="checkbox" name="Venue" /> Venue </li> -->
                </ul>
                <h4>Cost:</h4>
                <!--do we want this to dynamically change -->
                <ul id="cost">
                    <li><input type="checkbox" name="cost" id="lessThan500" />  < $500 </li>
                    <li><input type="checkbox" name="cost" id="500To2000" />  $500 - $2000 </li>
                    <li><input type="checkbox" name="cost" id="2000To5000" />  $2000 - $5000 </li>
                    <li><input type="checkbox" name="cost" id="moreThan5000" />  > $5000 </li>
                </ul>
                <h4>Tags:</h4>
                <ul id="tags">

                </ul>

                <input id="btnCheckAll" type="button" name="checkAll" value="Check All"/>
                <input id="btnUncheckAll" type="button" name="uncheckAll" value="Uncheck All"/>

            </div>
        </div>
        <div id="boardBackground">
            <div id='ideaBoard'>
                <a href="#" onclick="show('ideas')">
                    <div id="ideaHeader">
                        Ideas
                    </div>
                </a>
                <div id="ideaContent">
                    <button id="addIdeaButton" class="btn">Add a new sticky note</button>
                    <div>
                        
                    </div>
                </div>
                <div id="trashIcon">
                    <span class="glyphicon glyphicon-trash"></span>
                    
                </div>
            </div>
            <div id='decisionBoard'>
                <a href="#" onclick="show('decisions')">
                    <div id="decisionHeader">
                    Decisions
                    </div>
                </a>
                <div id="budgetTotalRemaining">
                    <a href="#" onclick="load('budget_page')">
                    Total Remaining: $<span id="budgetRemaining"></span></a>
                </div>
                <div id="decisionContent">
                    
                </div>            
            </div>
            <div id="ideaPopup" style="display: none;">
                <input type="text" id="ideaTitleInput" placeholder="Title *"/>
                <div id="dragAndDropPicUploader">
                        <div class="fallback">
                            <input name="file" type="file" multiple>
                        </div>
                </div>
                <div id="descriptionAndCost">
                    <textarea rows="4" id="ideaDescriptionInput" placeholder="Description"></textarea>
                    <input type="text" id="ideaCostInput" placeholder="Cost *"/>
                </div>
                <div id="tagsAndCategory">
                    <div id="ideaCategoryPicker">
                        <div id="categoryPopover">
                            <select id="categoryDropDown" placeholder="Category">
                                <option disabled selected>Select a Category *</option>
                                <option value="Catering">Catering</option>
                                <option value="Clothing">Clothing</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Flowers">Flowers</option>
                                <option value="Invitations">Invitations</option>
                                <option value="Venue">Venue</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <input type="text" id="ideaTagInput" value="" data-role="tagsinput" placeholder="Add tags" />
                </div>
                <button id="saveIdeaButton" class="btn">Save</button>
                <button id="cancelIdeaButton" class="btn">Cancel</button>
            </div>
        </div>
        <div id='ideaView' style="display: none;">
        </div>
        <div id="budget_link" >
            <iframe id="budget_iframe" src="budget.html" seamless></iframe>
        </div>
        <div id="wrapper" class="deleted_archive_view">
        <h2>Deleted Archive</h2>
        <table id="keywords" cellspacing="0" cellpadding="0">
            <thead>
                <tr>
                    <th><span>Title</span></th>
                    <th><span>Category</span></th>
                    <th><span>Cost</span></th>
                    <th>Restore?</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        </div>
    </body>
</html>