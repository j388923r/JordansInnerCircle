<html>
    <head>
        <title>Simple As Love</title>
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
        
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

        <link rel="stylesheet" href="mainLayout.css">
        
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        
        <style>
        
            body {
                padding-left:2%;
                background-color:salmon;
            }
            
            h1 {
                margin: 0px;
                padding-right: 2%;
                font-family: "Comic Sans MS", cursive, sans-serif;
                display: inline-block;
            }
            
            .navigationbar {
            
            }
            
            ul.header {
                display: inline;
                padding: 0px;
                margin: 0px;
            }
            
            a:hover {
                color:black;
                text-decoration: none;
            }
            
            h1 a:hover {
                text-decoration: none;
            }
            
            .header li {
                font: 20pt bold "Pacifico";
                width:12%;
                padding: 1%;
                margin: 1%;
                display:inline-block;
                background-color: #E5D058;
                text-align: center;
                border-radius: 5px;
            }
            
            #boardBackground {
                border-radius: 10px;
                width: 96%;
                height: 90%;
                background-color: rgba(167, 167, 167, 0.99);
                display: inline-block;
            }
            
            #ideaBoard {
                border-radius: 10px;
                margin:2%;
                margin-left: 3%;
                width: 45%;
                height: 93%;
                background-color: rgba(255, 255, 255, 1.0);
                float: left;
                z-index: 10;
            }
            
            #decisionBoard {
                border-radius: 10px;
                margin:2%;
                margin-left: 52%;
                width: 45%;
                height: 93%;
                background-color: rgba(255, 255, 255, 1.0);
                z-index: 10;
            }
            
            #decisionHeader, #ideaHeader {
                position: absolute;
                margin-top: -20px;
                height: 40px;
                width: 12%;
                border-radius: 5px;
                background-color: #EEEEEE;
                text-align: center;
                font-size: 2em;
                z-index: 11;
            }
            
            #ideaHeader {
                margin-left: 15.5%;
            }
            
            #decisionHeader {
                margin-left: 15.5%;
            }
            
            #filterPopover {
                position: absolute;
                background-color: lightblue;
                border-radius: 5px;
                padding: 5px;
            }
            
            #categories {
                list-style-type: none;
                padding-left: 1em
            }
            #cost {
                list-style-type: none;
                padding-left: 1em
            }
            #tags {
                list-style-type: none;
                padding-left: 1em
            }
                
            .modal {
                position: fixed;
                opacity: 0;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                background: rgba(0, 0, 0, .7);
                z-index: 99999;
            }
                
            .modal:target {
                opacity: 1;
            }
                
            #budgetModal > div {
                width: 400px;
                position: relative;
                margin: 10% auto;
                padding: 5px 20px 13px 20px;
            }

            #addIdeaButton {
                position: relative;
                left: 39%;
                top: 5%;
            }
        </style>
        
        <script>

            var costMapping = {'lessThan500':[], '500To2000':[], '2000To5000':[], 'moreThan5000': []};
            var categoryMapping = {};
            var tagsMapping = {};

            var categorieslist = ["Clothing","Entertainment","Flowers","Venue"];
            var tagsList = ["cool", "vegas", "prince"];

            var costFilters = [];
            var categoryFilters = [];
            var tagFilters = [];

            var allNonDeletedIdeas = [];
            var deletedIdeas = [];
            var ideasInIdeas = [];
            var ideasInDecisions = [];

            var isAllChecked = false;
            var checked_arr = [];

            $(document).ready(function(){
                var ideaBoard = document.getElementById('ideaBoard');


                var decisionBoard = document.getElementById('decisionBoard');
                var first =  document.getElementById('lessThan500');
                var second = document.getElementById('500To2000');
                var third = document.getElementById('2000To5000');
                var fourth = document.getElementById('moreThan5000');

                first.addEventListener("change", checkboxChange);
                second.addEventListener("change", checkboxChange);
                third.addEventListener("change", checkboxChange);
                fourth.addEventListener("change", checkboxChange);

                buildFilter(categorieslist, tagsList); //change to names

                $('[data-toggle="popover"]').popover({
                    placement : 'bottom',
                    content : '<input type="text" placeholder="Filter term"/>'
                });
                $('#filters').click(function() {
                    var categories = document.getElementById("filterPopover");
                    categories.hidden = !categories.hidden;
                    buildFilter(categorieslist, tagsList); //change to names
                });

                $('#btnCheckAll').click(function() {
                    isAllChecked = true;
                    checkAll();
                });

                $('#btnUncheckAll').click(function() {
                    uncheckAll();
                    isAllChecked = false;
                });

                $('#search').keyup(function(e) {
                    if (e.keyCode == 13){
                        var input = $("#search");
                        var inputValue = $(input).val();
                        console.log(inputValue);
                    }
                })

                $('#addIdeaButton').click(function(){
                    ideaPopupBuilder();
                });

            });
            //function that takes in categories and tags list and contructs the filter 
            //do we want to do cost filtering dynamically or have set intervals

            var buildFilter = function(cat_arr, tag_arr) {
                cat_arr.sort();
                tag_arr.sort();
                $("#categories").html("");
                $("#tags").html("");
                for (var i = 0; i < cat_arr.length; i++) {
                    var cat = cat_arr[i];
                    var newCat = document.createElement("input");
                    newCat.type = "checkbox";
                    newCat.name = "cat";
                    newCat.id = cat;
                    newCat.onchange = checkboxChange;
                    
                    newCat.checked = isAllChecked;

                    for(var j = 0; j < checked_arr.length; j++){
                        if(checked_arr[j] == cat){
                            newCat.checked = true;
                        }
                    }

                    var newList = document.createElement("li");

                    $(newList).append(newCat);
                    $(newList).append("  " + cat);
                    // var newString = "<li><input type=\"checkbox\" name="+ cat+" />  " + cat+ "</li>"; //might need to change to allow addition of event listeners
                    $("#categories").append(newList);
                };
                for (var i = 0; i < tag_arr.length; i++) {
                    var tag = tag_arr[i];
                    var newTag = document.createElement("input");
                    newTag.type = "checkbox";
                    newTag.name = "tag";
                    newTag.id = tag;
                    
                    newTag.checked = isAllChecked;
                    newTag.onchange = checkboxChange;

                    for(var j = 0; j < checked_arr.length; j++){
                        if(checked_arr[j] == tag){
                            newTag.checked = true;
                        }
                    }

                    var newList = document.createElement("li");

                    $(newList).append(newTag);
                    $(newList).append("  " + tag);
                    // var newString = "<li><input type=\"checkbox\" name="+ tag+" />  " + tag+ "</li>";
                    $("#tags").append(newList);
                };
            }

            var checkAll = function() {
                var boxes = document.getElementsByTagName('input');
                for(var i = 0; i< boxes.length; i++){
                    if(boxes[i].type == 'checkbox') {
                        boxes[i].checked = true;
                    }
                }
            }

            var uncheckAll = function() {
                var boxes = document.getElementsByTagName('input');
                for(var i = 0; i< boxes.length; i++){
                    if(boxes[i].type == 'checkbox') {
                        boxes[i].checked = false;
                        checked_arr = []
                    }
                }
            }

            var checkboxChange = function() {
                if(this.checked){
                    console.log(this.name);
                    checked_arr.push(this.id);
                    if(this.name == "cat"){
                        categoryFilters.push(this.id);
                    }
                    else if(this.name = "cost"){
                        costFilters.push(this.id);
                    }
                    else {
                        tagFilters.push(this.id);
                    }


                }
                else{
                    console.log("remove filter")
                    for(var i = 0; i < checked_arr.length; i++){
                        if(checked_arr[i]== this.id){
                            checked_arr.splice(i,1);
                        }
                    }
                    if(this.name == "cat"){
                        for(var i = 0; i < categoryFilters.length; i++){
                            if(categoryFilters[i]== this.id){
                                categoryFilters.splice(i,1);
                            }
                        }
                    }
                    else if(this.name = "cost"){
                        for(var i = 0; i < costFilters.length; i++){
                            if(costFilters[i]== this.id){
                                costFilters.splice(i,1);
                            }
                        }
                    }
                    else {
                        for(var i = 0; i < tagFilters.length; i++){
                            if(tagFilters[i]== this.id){
                                tagFilters.splice(i,1);
                            }
                        }
                    }

                }
                updateFilter();
            }

            var updateFilter = function() {
                var costset = [];
                var catset = [];
                var tagset = [];
                var ideasToShow = [];
                for(var i = 0; i< costFilters.length; i++){
                    listUnion(costset,costMapping[costFilters[i]]);
                }
                for(var i = 0; i< tagFilters.length; i++){
                    listUnion(tagset, tagsMapping[tagFilters[i]]);
                }
                for(var i = 0; i< categoryFilters.length; i++){
                    listUnion(catset, categoryMapping[categoryFilters[i]]);
                }
                if(costFilters.length == 0){
                    costset = allNonDeletedIdeas;
                }
                if(tagFilters.length == 0){
                    tagset = allNonDeletedIdeas;
                }
                if(categoryFilters.length == 0 ) {
                    catset = allNonDeletedIdeas;
                }
                var temp_arr = listInter(catset, costset);
                ideasToShow = listInter(temp_arr, tagset);
                for(var i = 0; i < allNonDeletedIdeas.length; i++){
                    //not sure how to hide an idea but trying to do that here
                    allNonDeletedIdeas[i].hide();
                }
                for(var i = 0; i< ideasToShow.length; i++){
                    ideasToShow[i].show();
                }

            }

            var searching = function(term) {


            }

            var listUnion = function(list1, list2) {
                var retList = list1;
                var list2 = list2;
                for(var i = 0; i < list2.length; i++){
                    var inRetList = false;
                    for(var j = 0; j < retList.length; j++){
                        if(list2[i] == retList[j]){
                            inRetList = true;
                        }
                    }
                    if(!inRetList){
                        inRetList.push(list2[i]);
                    }
                }
                return retList;
            }

            var listInter = function(list1, list2) {
                var retList = [];
                var list1 = list1;
                var list2 = list2;
                for(var i = 0; i < list1.length; i++){
                    var matched = false;
                    for(var j = 0; j < list2.length; j++){
                        if(list1[i] == list2[j]){
                            matched = true;
                        }
                    }
                    if(matched){
                        retList.push(list1[i]);
                    }
                }
                return retList;
            }

            // Adding an Idea pop-up
            var ideaPopupBuilder = function(){
                

            }
        </script>
    </head>
    <body>
        <div class="navigationbar">
            <h1><a ref="/">Simple as Love</a></h1>
            <ul class="header">
                <li><a href="/">Main Page</a></li>
                <li><a href="#">Ideas</a></li>
                <li><a href="#">Decisions</a></li>
                <li><a href="#budgetModal">Budget</a></li>
                <li><a href="#">Deleted <br> Archive</a></li>
            </ul>
        </div>
        <div>
            <button id="filters" style="margin-bottom: 5px" class="btn">Filters <span class="glyphicon glyphicon-menu-down"></span></button>
            <div id="filterPopover">
                <input type="text" id = "search" placeholder="Search term"/><br>
                <h4>Categories:</h4>
                <ul id="categories">
                    <!-- <li><input type="checkbox" name="Clothing" /> Clothing </li>
                    <li><input type="checkbox" name="Entertainment" /> Entertainment </li>
                    <li><input type="checkbox" name="Flowers" /> Flowers </li>
                    <li><input type="checkbox" name="Venue" /> Venue </li> -->
                </ul>
                <h4>Cost:</h4>
                <!--do we want this to dynamically change -->
                <ul id="cost">
                    <li><input type="checkbox" name="cost" id="lessThan500" />  less than $500 </li>
                    <li><input type="checkbox" name="cost" id="500To2000" />  $500 to $2000 </li>
                    <li><input type="checkbox" name="cost" id="2000To5000" />  $2001 to $5000 </li>
                    <li><input type="checkbox" name="cost" id="moreThan5000" />  greater than $5000 </li>
                </ul>
                <h4>Tags:</h4>
                <ul id="tags">

                </ul>

                <input id="btnCheckAll" type="button" name="checkAll" value="Check All"/>
                <input id="btnUncheckAll" type="button" name="uncheckAll" value="Uncheck All"/>

            </div>
        </div>
        <div id="boardBackground">
            <div id='ideaBoard'>
                <div id="ideaHeader">
                    <a href="#" onclick="show('ideas')">Ideas</a>
                </div>
                <div>
                    
                </div>
                <button id="addIdeaButton" class="btn">Add New Idea</button>
                <div id="ideaPopup">
                    <form class="form" action="#" id="newIdeaForm">
                        <input type="text" 
            </div>
            <div id='decisionBoard'>
                <div id="decisionheader">
                    <a href="#" onclick="show('decisions')">Decisions</a>
                </div>
            </div>
        </div>
        <div id="budgetModal" class="modal">
            <div>	<a href="#close" title="Close" class="close">X</a>

        	<h2>Modal Box</h2>

            <p>This is a sample modal box that can be created using the powers of CSS3.</p>
            <p>You could do a lot of things here like have a pop-up ad that shows when your website loads, or create a login/register form for users.</p>
            </div>
        </div>
    </body>
</html>